---
title: Examples of Splice Machine Functions and Procedures
summary: Examples of creating and using database functions and stored procedures.
keywords:
toc: false
product: all
sidebar: developers_sidebar
permalink: developers_fcnsandprocs_examples.html
folder: Developers/FcnsAndProcs
---
	<section>
		<div class="TopicContent">
            <h1 id="kanchor384">Examples of Splice Machine Functions and Stored Procedures </h1>
            <p>This topic walks you through creating, storing, and using a sample database function and a sample database stored procedure, in these sections:</p>
            <ul>
                <li><a href="#CreatingSampleFunction">Creating and Using a Sample Function in Splice Machine</a>
                </li>
                <li><a href="#CreatingSampleProc">Creating and Using a Sample Stored Procedure in Splice Machine</a>
                </li>
            </ul>
            <h2 id="CreatingSampleFunction">Creating and Using a Sample Function in Splice Machine</h2>
            <p>This section walks you through creating a sample function named <span class="CodeFont">word_limiter</span> that limits the number of words in a string; for example, given this sentence:</p>
            <blockquote>
                <p><span class="AppCommand">Today is a wonderful day and I am looking forward to going to the beach.</span>
                </p>
            </blockquote>
            <p>If you tell <span class="CodeFont">word_limiter</span> to return the first five words in the sentence, the returned string would be:</p>
            <blockquote>
                <p><span class="AppCommand">Today is a wonderful day</span>
                </p>
            </blockquote>
            <p>Follow these steps to define and use the <span class="CodeFont">word_limiter</span> function:</p>
            <div class="opsStepsList">
                <ol class="boldFont">
                    <li>
                        <p class="topLevel">Define inputs and outputs</p>
                        <p class="indentLevel1">We have two inputs:</p>
                        <ul class="plainFont">
                            <li>the sentence that we want to limit</li>
                            <li>the number of words we want to limit the output to</li>
                        </ul>
                        <p class="indentLevel1">The output is a string that contains the limited words.</p>
                    </li>
                    <li>
                        <p class="topLevel">Create the shell of our Java class.</p>
                        <p class="indentLevel1">We create a class named <span class="CodeFont">ExampleStringFunctions</span> in the package <span class="CodeFont">com.splicemachine.examples</span>. </p>
                        <div class="preWrapperWide"><pre class="Example" xml:space="preserve">
package com.splicemachine.example;

public class ExampleStringFunctions {<br />...
}</pre>
                        </div>
                    </li>
                    <li>
                        <p class="topLevel">Create the <span class="CodeFont">wordLimiter</span> static method</p>
                        <p class="indentLevel1">This method contains the logic for returning the first n number of words:</p>
                        <div class="preWrapperWide"><pre class="Example">package com.splicemachine.example;

public class ExampleStringFunctions {
	/**
	 * Truncates a string to the number of words specified.  An input of
	 * "Today is a wonderful day and I am looking forward to going to the beach.", 5
	 * will return "Today is a wonderful day".
	 *
	 * @param inboundSentence
	 * @param numberOfWords
	 * @return
	 */
	public static String wordLimiter(String inboundSentence, int numberOfWords) {
		String truncatedString = "";
		if(inboundSentence != null) {
			String[] splitBySpace = inboundSentence.split("\\s+");
			if(splitBySpace.length = numberOfWords) {
				truncatedString = inboundSentence;
			} else {
				StringBuilder sb = new StringBuilder();
				for(int i=0; inumberOfWords; i++) {
					if(i &gt; 0) sb.append(" ");
					sb.append(splitBySpace[i]);
				}
				truncatedString = sb.toString();
			}
		}
		return truncatedString;
	}
}</pre>
                        </div>
                    </li>
                    <li>
                        <p class="topLevel">Compile the class and store the jar file</p>
                        <p class="indentLevel1">After you compile your class, make sure that the jar file is in a directory in your <span class="CodeFont">classpath</span>, so that it can be found. You can find more information about this in the <a href="developers_fcnsandprocs_storing.html">Storing and Updating Functions and Stored Procedures</a> topic in this section. </p>
                        <p class="indentLevel1">If you're using the standalone version of Splice Machine, you can use the following command line interface command:</p>
                        <div class="preWrapperWide"><pre class="AppCommand" xml:space="preserve">splice&gt;&#160;CALL&#160;SQLJ.INSTALL_JAR('/Users/me/dev/workspace/examples/bin/example.jar', 'SPLICE.MY_EXAMPLE_APP', 0);</pre>
                        </div>
                        <p class="indentLevel1">You must also update the database class path:</p>
                        <div class="preWrapperWide"><pre class="AppCommand" xml:space="preserve">splice&gt;&#160;CALL&#160;SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY('derby.database.classpath', 'SPLICE.MY_EXAMPLE_APP');</pre>
                        </div>
                    </li>
                    <li>
                        <p class="topLevel">Define the function in Splice Machine</p>
                        <p class="indentLevel1">You can find the complete syntax for <span class="CodeFont"><a href="sqlref_statements_createfunction.html">CREATE&#160;FUNCTION</a></span>&#160;in the <span class="ItalicFont">Splice Machine SQL&#160;Reference</span> manual. For our example function, we enter the following command at the <span class="CodeFont">splice&gt;</span>&#160;prompt:</p>
                        <div class="preWrapperWide"><pre class="AppCommand" xml:space="preserve">
splice&gt;&#160;CREATE FUNCTION WORD_LIMITER(MY_SENTENCE VARCHAR(9999), NUM_WORDS INT) RETURNS VARCHAR(9999)
LANGUAGE JAVA
PARAMETER STYLE JAVA
NO SQL
EXTERNAL NAME 'com.splicemachine.example.ExampleStringFunctions.wordLimiter';</pre>
                        </div>
                    </li>
                    <li>
                        <p class="topLevel">Run the function</p>
                        <p class="indentLevel1">You can run the function with this syntax:</p>
                        <div class="preWrapperWide"><pre class="AppCommand" xml:space="preserve">splice&gt;&#160;SELECT WORD_LIMITER('Today is a wonderful day and I am looking forward to going to the beach.', 5)
   FROM&#160;SYSIBM.SYSDUMMY1;</pre>
                        </div>
                    </li>
                </ol>
            </div>
            <h2 id="CreatingSampleProc">Creating and Using a Sample Stored Procedure in Splice Machine</h2>
            <p>In this section , we create a stored procedure named <span class="CodeFont">GET_INVENTORY_FOR_SKU</span> that retrieves all of the inventory records for a specific product by using the product's sku code. The input to this procedure is the sku code, and the output is a resultset of records from the inventory table.</p>
            <p>Follow these steps to define and use the <span class="CodeFont">GET_INVENTORY_FOR_SKU</span> function:</p>
            <div class="opsStepsList">
                <ol class="boldFont">
                    <li>
                        <p class="topLevel">Create and populate the inventory table</p>
                        <p class="indentLevel1">Connect to Splice Machine and create the following table from the command prompt or from an SQL&#160;client, using the following statements:</p>
                        <div class="preWrapperWide"><pre class="AppCommand" xml:space="preserve">
CREATE&#160;TABLE&#160;INVENTORY (
   SKU_CODE&#160;VARCHAR(30),
   WAREHOUSE&#160;BIGINT,
&#160;  QUANTITY&#160;BIGINT
);

INSERT INTO INVENTORY VALUES ('ABC123',1,50),('ABC123',2,100),('ABC123',3,60),('XYZ987',1,20),('XYZ321',2,0); </pre>
                        </div>
                    </li>
                    <li>
                        <p class="topLevel">Create the shell of our Java class.</p>
                        <p class="indentLevel1">We create a class named <span class="CodeFont">ExampleStringFunctions</span> in the package <span class="CodeFont">com.splicemachine.examples</span>. </p>
                        <div class="preWrapperWide"><pre class="Example" xml:space="preserve">
package com.splicemachine.example;

public class ExampleStoredProcedure{<br />...
}</pre>
                        </div>
                    </li>
                    <li>
                        <p class="topLevel">Create the <span class="CodeFont">getSkuInventory</span> static method</p>
                        <p class="indentLevel1">This method contains the logic for retrieving inventory records for the specified sku.</p>
                        <div class="preWrapperWide"><pre class="Example">package com.splicemachine.example;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
public class ExampleStoredProcedure {
   public static void getSkuInventory(String skuCode, ResultSet[] resultSet) throws SQLException {
      try {
           Connection con = DriverManager.getConnection("jdbc:default:connection");
           String sql = "select * from INVENTORY " + "where SKU_CODE = ?";
           PreparedStatement ps = con.prepareStatement(sql);
           ps.setString(1, skuCode);
           resultSet[0] = ps.executeQuery();;
      } catch (SQLException e) {
           throw e;
      }
   }
}</pre>
                        </div>
                    </li>
                    <li>
                        <p class="topLevel">Compile the class and store the jar file</p>
                        <p class="indentLevel1">After you compile your class, make sure that the jar file is in a directory in your <span class="CodeFont">classpath</span>, so that it can be found. You can find more information about this in the <a href="developers_fcnsandprocs_storing.html">Storing and Updating Functions and Stored Procedures</a> topic in this section. </p>
                        <p class="indentLevel1">If you're using the standalone version of Splice Machine, you can use the following command line interface command:</p>
                        <div class="preWrapperWide"><pre class="AppCommand" xml:space="preserve">splice&gt;&#160;CALL&#160;SQLJ.INSTALL_JAR('/Users/me/dev/workspace/examples/bin/example.jar', 'SPLICE.GET_SKU_INVENTORY', 0);</pre>
                        </div>
                        <p class="indentLevel1">You must also update the database class path:                <div class="preWrapperWide"><pre class="AppCommand" xml:space="preserve">splice&gt;&#160;CALL&#160;SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY('derby.database.classpath', 'SPLICE.GET_SKU_INVENTORY');</pre></div></p>
                    </li>
                    <li>
                        <p class="topLevel">Define the procedure in Splice Machine</p>
                        <p class="indentLevel1">For our procedure, we enter the following command at the <span class="CodeFont">splice&gt;</span>&#160;prompt:</p>
                        <div class="preWrapperWide"><pre class="AppCommand" xml:space="preserve">
splice&gt;&#160;CREATE PROCEDURE GET_INVENTORY_FOR_SKU(SKU_CODE VARCHAR(30))
LANGUAGE JAVA
PARAMETER STYLE JAVA
READS&#160;SQL&#160;DATA
EXTERNAL NAME 'com.splicemachine.example.ExampleStoredProcedure.getSkuInventory';</pre>
                        </div>
                    </li>
                    <li>
                        <p class="topLevel">Run the stored procedure</p>
                        <p class="indentLevel1">You can run the procedure with this syntax:</p>
                        <div class="preWrapperWide"><pre class="AppCommand" xml:space="preserve">splice&gt;&#160;call GET_INVENTORY_FOR_SKU('ABC123');</pre>
                        </div>
                    </li>
                </ol>
            </div>
        </div>
	</section>
