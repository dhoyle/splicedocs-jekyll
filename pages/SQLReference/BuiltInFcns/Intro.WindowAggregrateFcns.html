---
title: Window and Aggregate Functions in Splice Machine SQL
summary: Summarizes the window and aggregate functions you can use to evaluate an expression over a set of rows in Splice Machine SQL.
keywords: window functions, aggregate functions
toc: false
product: all
sidebar:  sqlref_sidebar
permalink: sqlref_builtinfcns_windowfcnsintro.html
folder: SQLReference/BuiltInFcns
---
	<section>
		<div class="TopicContent" data-swiftype-index="true" markdown="1">
            <h1>Window and Aggregate Functions</h1>
            <p>This section contains the Aggregate and Window (analytic)&#160;functions built into Splice Machine SQL.</p>
            <ul>
                <li><a href="#Aggregat">Aggregate functions</a>, which are sometimes referred to as set functions, provide a means of evaluating an expression over a set of rows. Each aggregate function outputs one value for the set of rows on which it operates. All aggregate functions can also be used as window functions.</li>
                <li>
                    <p><a href="#Window">Window functions</a>, which are sometimes referred to as <em>analytic functions</em>, perform calculations across a set of table rows that are related to the current row. Each window function outputs one value for each row on which it operates. Some of the window functions <em>cannot</em> be used as aggregate functions. </p>
                    <p class="noteNote">A subset of the window functions are sometimes referred to as <em>ranking functions</em>, as noted below.</p>
                </li>
            </ul>
            <table summary="Summary of Splice Machine SQL Window and Aggregate Functions">
                <col />
                <col />
                <col />
                <col />
                <thead>
                    <tr>
                        <th><strong>Function Name</strong>
                        </th>
                        <th>Window or Aggregate</th>
                        <th>Description</th>
                        <th>Permitted Data Types</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code><a href="sqlref_builtinfcns_avg.html">AVG</a></code>
                        </td>
                        <td>Both</td>
                        <td>Returns the average computed over a subset (partition) of a table.</td>
                        <td>The <a href="#numeric_built-in_data_types_">numeric built-in data types</a>.</td>
                    </tr>
                    <tr>
                        <td><code><a href="sqlref_builtinfcns_count.html">COUNT</a></code>
                        </td>
                        <td>Both</td>
                        <td>Returns the number of rows in a partition.</td>
                        <td>All types.</td>
                    </tr>
                    <tr>
                        <td><code><a href="sqlref_builtinfcns_denserank.html">DENSE_RANK</a></code>
                        </td>
                        <td>Window</td>
                        <td>A ranking function that returns the ranking of a row within a partition.</td>
                        <td>The <a href="#numeric_built-in_data_types_">numeric built-in data types</a>.</td>
                    </tr>
                    <tr>
                        <td><code><a href="sqlref_builtinfcns_firstvalue.html">FIRST_VALUE</a></code>
                        </td>
                        <td>Window</td>
                        <td>Returns the first value within  a partition..</td>
                        <td>All types.</td>
                    </tr>
                    <tr>
                        <td><code><a href="sqlref_builtinfcns_lag.html">LAG</a></code>
                        </td>
                        <td>Window</td>
                        <td>Returns the value of an expression evaluated at a specified offset number of rows <em>before</em> the current row in a partition.</td>
                        <td>All types.</td>
                    </tr>
                    <tr>
                        <td><code><a href="sqlref_builtinfcns_lastvalue.html">LAST_VALUE</a></code>
                        </td>
                        <td>Window</td>
                        <td>Returns the last value within a partition..</td>
                        <td>All types.</td>
                    </tr>
                    <tr>
                        <td><code><a href="sqlref_builtinfcns_lead.html">LEAD</a></code>
                        </td>
                        <td>Window</td>
                        <td>Returns the value of an expression evaluated at a specified offset number of rows <em>after</em> the current row in a partition.</td>
                        <td>All types.</td>
                    </tr>
                    <tr>
                        <td><code><a href="sqlref_builtinfcns_max.html">MAX</a></code>
                        </td>
                        <td>Both</td>
                        <td>Returns the maximum value computed over a partition.</td>
                        <td>The <a href="#numeric_built-in_data_types_">numeric built-in data types</a>.</td>
                    </tr>
                    <tr>
                        <td><code><a href="sqlref_builtinfcns_min.html">MIN</a></code>
                        </td>
                        <td>Both</td>
                        <td>Returns the minimum value computed over a partition.</td>
                        <td>The <a href="#numeric_built-in_data_types_">numeric built-in data types</a>.</td>
                    </tr>
                    <tr>
                        <td><code><a href="sqlref_builtinfcns_rank.html">RANK</a></code>
                        </td>
                        <td>Window</td>
                        <td>A ranking function that returns the ranking of a row within a subset of a table.</td>
                        <td>The <a href="#numeric_built-in_data_types_">numeric built-in data types</a>.</td>
                    </tr>
                    <tr>
                        <td><code><a href="sqlref_builtinfcns_rownumber.html">ROW_NUMBER</a></code>
                        </td>
                        <td>Window</td>
                        <td>
                            <p>A ranking function that returns the row number of a row within a partition.</p>
                        </td>
                        <td>The <a href="#numeric_built-in_data_types_">numeric built-in data types</a>.</td>
                    </tr>
                    <tr>
                        <td><code><a href="sqlref_builtinfcns_stddevpop.html">STDDEV_POP</a></code>
                        </td>
                        <td>Both</td>
                        <td>Returns the sum of a value calculated over a partition.</td>
                        <td>The <a href="#numeric_built-in_data_types_">numeric built-in data types</a>.</td>
                    </tr>
                    <tr>
                        <td><code><a href="sqlref_builtinfcns_stddevsamp.html">STDDEV_SAMP
                        </a></code>
                        </td>
                        <td>Both</td>
                        <td>Returns the sum of a value calculated over a partition.</td>
                        <td>The <a href="#numeric_built-in_data_types_">numeric built-in data types</a>.</td>
                    </tr>
                    <tr>
                        <td><code><a href="sqlref_builtinfcns_sum.html">SUM</a></code>
                        </td>
                        <td>Both</td>
                        <td>Returns the sum of a value calculated over a partition.</td>
                        <td>The <a href="#numeric_built-in_data_types_">numeric built-in data types</a>.</td>
                    </tr>
                </tbody>
            </table>
            <h3 id="numeric_built-in_data_types_">The Numeric Built-in Data Types</h3>
            <p class="indentLevel1">The numeric built-in data types are:&#160;<a href="sqlref_builtinfcns_smallint.html"><code>SMALLINT</code></a>.</p>
            <h2 id="Aggregat">Using Aggregate Functions</h2>
            <p>Aggregate functions (also described as <em>set functions</em> in ANSI SQL and as <em>column functions</em> in some database literature). They provide a means of evaluating an expression over a set of rows. </p>
            <p>Whereas the other built-in functions operate on a single expression, aggregates operate on a set of values and reduce them to a single scalar value. Built-in aggregates can calculate the minimum, maximum, sum, count, and average of an expression over a set of values as well as count rows. The following table shows the data types on which each built-in aggregate function can operate.</p>
            <p>Aggregates are permitted only in the following:</p>
            <ul>
                <li>A <em>SelectItem</em> in a <em><a href="sqlref_expressions_select.html">SelectExpression</a>.</em></li>
                <li>A <a href="sqlref_clauses_having.html"><code>HAVING</code> clause</a>.</li>
                <li>An <a href="sqlref_clauses_orderby.html"><code>ORDER BY</code> clause</a> if
			and only if the aggregate appears in a <em>SelectItem</em> in a <em><a href="sqlref_expressions_select.html">SelectExpression</a>.</em></li>
            </ul>
            <p>All expressions in <em>SelectItems</em> in the <em><a href="sqlref_expressions_select.html">SelectExpression</a></em> must
		be either aggregates or grouped columns (see <a href="sqlref_clauses_groupby.html"><code>GROUP BY</code> clause</a>).(The same is true if there is a <code>HAVING</code> clause without a <code>GROUP BY</code> clause.)</p>
            <p>This is because the <em>ResultSet</em> of a <em><a href="sqlref_expressions_select.html">SelectExpression</a></em> must
		be either a scalar (single value) or a vector (multiple values), but not a mixture of both. (Aggregates evaluate to a scalar value, and the referenceto a column can evaluate to a vector.) For example, the following query mixes scalar and vector values and thus is not valid:</p>
            <div class="preWrapper"><pre class="Example" xml:space="preserve">   -- not valid
SELECT MIN(flying_time), flight_id
  FROM Flights;</pre>
            </div>
            <p>Aggregates are not allowed on outer references (correlations). This means that if a subquery contains an aggregate, that aggregate cannot evaluate an expression that includes a reference to a column in the outer query block. For example, the following query is not valid because SUM operates on a column from the outer query:</p>
            <div class="preWrapper"><pre class="Example" xml:space="preserve">SELECT c1
  FROM t1
  GROUP BY c1
  HAVING c2 &gt;
  SELECT t2.x
  FROM t2
  WHERE t2.y = SUM(t1.c3));</pre>
            </div>
            <h2 id="Window">Using Window Functions</h2>
            <p>Window functions, sometimes referred to as <em>analytic</em> functions, perform calculations across a set of table rows that are related to the current row. They are similar to aggregate functions, with several significant differences; a window function:</p>
            <ul>
                <li>Always includes an <code><a href="sqlref_clauses_over.html">OVER</a></code>&#160;clause</li>
                <li>Outputs one row for each input value it operates upon.</li>
                <li>Groups rows with window partitioning and frame clauses, rather than using <code><a href="sqlref_clauses_groupby.html">GROUP BY</a></code> clauses</li>
            </ul>
            <p class="noteNote">Most developers who are new to window functions find that the easiest way to understand them is to view examples, such as the ones in the <a href="developers_fundamentals_windowfcns.html">Window Functions</a> topic in our <em>Splice Machine Developer's Guide</em>.</p>
            <p>Window functions can be used to handle complex analysis and reporting. For example, it's easy to output running totals, moving averages for a specific time frame, and similar functions. There are a few simple rules about window function usage you need to know:</p>
            <ul>
                <li>Window functions are permitted only in the <code>SELECT</code> list and the <code>ORDER BY</code> clause of the query. They are forbidden elsewhere, such as in <code>GROUP BY</code>, <code>HAVING</code> and <code>WHERE</code> clauses. These restrictions are due to the fact that window functions execute after the processing of those clauses.</li>
                <li>You can include an aggregate function call in the arguments to a window function; however, you cannot include a window function in the arguments to a regular aggregate function. This is again due to the fact that window functions execute after regular aggregate functions have executed.</li>
                <li> When the function runs, a window of rows is computed in relation to the current row; as the current row advances, the window moves along with it.</li>
            </ul>
            <p>The rows considered by a window function (its input rows)&#160;are those of the <em>virtual table</em> produced by the query's <code>FROM</code> clause as filtered by its <code>WHERE</code>, <code>GROUP BY</code>, and <code>HAVING</code> clauses, if any. This means, for example, that a row removed because it does not meet the <code>WHERE</code> condition is not seen by any window function. A query can contain multiple window functions that slice up the data in different ways by means of different <code>OVER</code> clauses, but they all act on the same collection of rows defined by this virtual table.</p>
            <p>For examples and further explanation of window functions, please see the <a href="developers_fundamentals_windowfcns.html">Window Functions</a> topic in our <em>Splice Machine Developer's Guide</em>.</p>
            <h2>See Also</h2>
            <ul>
                <li><a href="sqlref_datatypes_numerictypes.html">About Data Types</a>
                </li>
                <li><a href="sqlref_builtinfcns_currentdate.html"><code>AVG</code></a> function</li>
                <li><a href="sqlref_builtinfcns_count.html"><code>COUNT</code></a> function</li>
                <li><a href="sqlref_builtinfcns_denserank.html"><code>DENSE_RANK</code></a>&#160;function</li>
                <li><a href="sqlref_builtinfcns_firstvalue.html"><code>FIRST_VALUE</code></a>&#160;function</li>
                <li><a href="sqlref_builtinfcns_lag.html"><code>LAG</code></a>&#160;function</li>
                <li><a href="sqlref_builtinfcns_lastvalue.html"><code>LAST_VALUE</code></a>&#160;function</li>
                <li><a href="sqlref_builtinfcns_lead.html"><code>LEAD</code></a>&#160;function</li>
                <li><a href="sqlref_builtinfcns_max.html"><code>MAX</code></a> function</li>
                <li><a href="sqlref_builtinfcns_min.html"><code>MIN</code></a> function</li>
                <li><a href="sqlref_builtinfcns_rank.html"><code>RANK</code></a>&#160;function</li>
                <li><a href="sqlref_builtinfcns_rownumber.html"><code>ROW_NUMBER</code></a>&#160;function</li>
                <li><a href="sqlref_builtinfcns_sum.html"><code>SUM</code></a> function</li>
                <li><a href="sqlref_expressions_select.html"><code>SELECT</code></a> expression</li>
                <li><a href="sqlref_clauses_groupby.html"><code>GROUP&#160;BY</code></a>&#160;clause</li>
                <li><a href="sqlref_clauses_having.html"><code>HAVING</code></a>&#160;clause</li>
                <li><a href="sqlref_clauses_orderby.html"><code>ORDER&#160;BY</code></a>&#160;clause</li>
                <li><em><a href="developers_fundamentals_windowfcns.html">Using Window Functions</a></em> in the <em>Developer Guide</em>.</li>
            </ul>
        </div>
	</section>
