---
title: WITH clause
summary: The WITH clause is also known as the subquery refactoring clause, and is used to name a subquery, which improves readability and can improve query efficiency.
keywords: WITH CLAUSE, Common Table Expression, CTE
toc: false
product: all
sidebar:  sqlref_sidebar
permalink: sqlref_clauses_with.html
folder: SQLReference/Clauses
---
	<section>
		<div class="TopicContent" data-swiftype-index="true" markdown="1">
            <h1>WITH CLAUSE&#160;(Common Table Expression)</h1>
            <p>You can use Common Table Expressions, also known as the <code>WITH</code> clause, to break down complicated queries into simpler parts by naming and referring to subqueries within queries. </p>
            <p>A Common Table Expression (CTE)&#160;provides a way of defining a temporary result set whose definition is available only to the query in which the CTE is defined.  The result of the CTE is not stored; it exists only for the duration of the query.
CTEs are helpful in reducing query complexity and increasing readability.  They can be used as substitutions for views in cases where either you dont have permission to create a view or the query would be the only one using the view.  CTEs allow you to more easily enable grouping by a column that is derived from a scalar sub select or a function that is non deterministic.
</p>
            <p class="noteNote">The <code>WITH</code> clause is also known as the <em>subquery factoring clause</em>.</p>
            <p>The handling and syntax of <code>WITH</code> queries are similar to the handling and syntax of views. The <code>WITH</code> clause can be processed as an inline view and shares syntax with <code>CREATE VIEW</code>. The <code>WITH</code> clause can also resolve as a temporary table, which may enhance the efficiency of a query.</p>
            <h2>Syntax</h2>
            <div class="fcnWrapperWide"><pre class="FcnSyntax">WITH <em>queryName</em> <br /> &#160;&#160;AS SELECT&#160;<em><a href="sqlref_queries_query.html">Query</a></em></pre>
            </div>
            <div class="paramList">
                <p class="paramName">queryName</p>
                <p class="paramDefnFirst">An identifier that names the subquery clause.</p>
            </div>
	        <h2>Restrictions</h2>
    	    <p class="body">You cannot currently use a temporary table in a <code>WITH</code>&#160;clause. This is being addressed in a future release of Splice Machine.</p>
            <h2>Examples</h2>
            <p class="body">If we create the following table:</p>
            <div class="preWrapperWide"><pre class="Example">CREATE TABLE BANKS (
&#160;&#160;&#160;&#160;&#160;&#160;&#160;INSTITUTION_ID INTEGER NOT NULL,
&#160;&#160;&#160;&#160;&#160;&#160;&#160;INSTITUTION_NAME VARCHAR(100),
&#160;&#160;&#160;&#160;&#160;&#160;&#160;CITY VARCHAR(100),
&#160;&#160;&#160;&#160;&#160;&#160;&#160;STATE VARCHAR(2),
&#160;&#160;&#160;&#160;&#160;&#160;&#160;TOTAL_ASSETS DECIMAL(19,2),
&#160;&#160;&#160;&#160;&#160;&#160;&#160;NET_INCOME DECIMAL(19,2),
&#160;&#160;&#160;&#160;&#160;&#160;&#160;OFFICES INTEGER,
&#160;&#160;&#160;&#160;&#160;&#160;&#160;PRIMARY KEY(INSTITUTION_ID)
);</pre>
            </div>
            <p class="body">We can then use a common table expression to improve the readability of a statement that finds the per-city total assets and income for the states with the top net income:</p>
            <div class="preWrapperWide"><pre class="Example">WITH state_sales AS (
&#160;&#160;&#160;&#160;&#160;&#160;&#160;SELECT STATE, SUM(NET_INCOME) AS total_sales
&#160;&#160;&#160;&#160;&#160;&#160;&#160;FROM BANKS
&#160;&#160;&#160;&#160;&#160;&#160;&#160;GROUP BY STATE
   ), top_states AS (
&#160;&#160;&#160;&#160;&#160;&#160;&#160;SELECT STATE
&#160;&#160;&#160;&#160;&#160;&#160;&#160;FROM state_sales
&#160;&#160;&#160;&#160;&#160;&#160;&#160;WHERE total_sales &gt; (SELECT SUM(total_sales)/10 FROM state_sales)
   )
SELECT STATE,
&#160;&#160;&#160;&#160;&#160;&#160;&#160;CITY,
&#160;&#160;&#160;&#160;&#160;&#160;&#160;SUM(TOTAL_ASSETS) AS assets,
&#160;&#160;&#160;&#160;&#160;&#160;&#160;SUM(NET_INCOME) AS income
FROM BANKS
WHERE STATE IN (SELECT STATE FROM top_states)
GROUP BY STATE, CITY;
</pre>
            </div>
            <h2>See Also</h2>
            <ul>
                <li><a href="sqlref_expressions_select.html"><code>SELECT</code></a> expression</li>
                <li><a href="sqlref_queries_query.html"><code>Query</code></a>&#160;</li>
            </ul>
            <div class="hiddenText">WITH</div>
        </div>
	</section>
