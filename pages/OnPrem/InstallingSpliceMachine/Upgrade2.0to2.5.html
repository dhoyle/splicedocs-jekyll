---
title: Upgrading from Splice Machine V2.0 to Splice Machine V2.5
summary: Walks you through upgrading your Splice Machine V2.0 Database
keywords: upgrading, 2.0, 2.5,
sidebar:  onprem_sidebar
toc: false
product: all
permalink: onprem_install_upgradev2.0.html
folder: OnPrem/InstallingSpliceMachine
---

<section>
    <div class="TopicContent">
        <H1>Upgrading Splice Machine Version 2.0 to Version 2.5</H1>
        <p>This topic walks you through upgrading your Splice Machine Database from version 2.0 to version 2.5, in these steps:</p>
        <ul>
            <li><a href="#backup">Run a Full Backup</a></li>
            <li><a href="#latervers">If Necessary, Upgrade to a Later Version of 2.0</a></li>
            <li><a href="#tartupgrade">Start the Upgrade</a></li>
            <li><a href="#install">Install Version 2.5</a></li>
            <li><a href="#configure">Make Configuration Changes</a></li>
        </ul>
        <h2 id="backup">Step 1: Run a Full Backup</h2>
        <p><a href="onprem_admin_backingup.html">Back up your database</a>, so that you can recover if anything goes amiss.</p>
        <p>We also recommend that you create a JSON backup dump of your current 2.0 configuration, which you'll find here:</p>
        <div class="preWrapperWide"><pre class="Plain">http://<span class="Highlighted"><your cloudera manager host></span>:7180/api/v12/cm/deployment</pre></div>
        <h2 id="latervers">Step 2: If Necessary, Upgrade to a Later Version of 2.0</h2>
        <p>This upgrade requires you to start with a Version 2.0 release that includes the needed upgrade code, which is any version numbered 2.0.1.1725 or greater. If you're running an earlier version of Splice Machine v2.0, please follow these steps before starting the upgrade to 2.5:</p>
        <ol>
            <li>Deploy version 2.0.1.1725 or later.</li>
            <li>Activate and restart hbase.</li>
                    <li>Verify that the upgrade was successful: You should see this message in the HBase master log:
                        <p class="indentLevel1"><span class="ItalicFont">Conglomerates upgrade complete</span></p></li>
            <li>Wait for hbase to complete startup and make sure you can connect and run some queries.</li>
        </ol>
        <h3>Recovering from Upgrade Issues</h3>
        <p>If your upgrade to a more recent 2.0 version fails, you can recover by following these steps:</p>
        <ol>
            <li>Deactivate the newly installed Splice Machine 2.0 parcel.</li>
            <li>Deploy and activate your previous Splice Machine 2.0 parcel.</li>
            <li>Restart HBase.</li>
            <li><a href="onprem_admin_cleaningdb.html">Flatten (clean) your database</a>.</li>
            <li><a href="onprem_admin_backingup.html">Restore your database</a> from the backup you created at the beginning of this process.</li>
            <li><a href="onprem_admin_startingdb.html">Restart all cluster services"</a>.</li>
        </ol>
        <h2 id="startupgrade">Step 3: Start the Upgrade</h2>
        <p>The first upgrade step is to prepare your cluster for the new version, following these steps:</p>
        <ol>
            <li><a href="onprem_admin_shuttingdowndb.html">Shut down your cluster</a>.</li>
            <li>Upgrade the version of JDK running on all cluster nodes to 1.8:
                <ul>
                    <li>Install to <span class="CodeFont">/usr/java</span></li>
                    <li>Delete any other versions of JDK from <span class="CodeFont">/usr/java</span></li>
                </ul>
            <li>Delete the Spark service in CM.</li>
            <li>Delete all Spark jars from <span class="CodeFont">/opt/cloudera/parcels/CDH/jars/</span></li>
        </ol>
        <h2 id="install">Step 4: Now install and activate Splice Machine, version 2.5.</h2>
        <div class="noteIcon">Activate Splice Machine, but <span class="BoldFont">DO NOT restart your cluster yet!</span></div>
        <p>Run the following script on each node in your cluster:</p>
        <div class="PreWrapperWide"><pre class="ShellCommand">sudo /opt/cloudera/parcels/SPLICEMACHINE/scripts/install-splice-symlinks.sh</pre></div>
        <h2 id="configure">Step 5: Make Configuration Changes for Version 2.5</h2>
        <p>You need to make several updates in your Hadoop configuration so that 2.5 works properly, including:</p>
        <ul>
            <li><a href="#yarnupd">YARN Updates</a></li>
            <li><a href="#hbaseupd">HBase Updates</a></li>
        </ul>
        <div class="noteNote">Please refer to our <a href="onprem_install_cloudera.html#Configur8" target="_blank">Cloudera Installation topic</a> (onprem_install_cloudera.html) when making these modifications.</div>
        <h3 id="yarnupd">Yarn Updates</h3>
        <p>You need to add the same two property values to each of four <a href="onprem_install_cloudera.html#Configur2">YARN advanced configuration settings</a>.</p>
        <p>Add these properties:</p>
        <table>
            <col />
            <col />
            <thead>
                <tr>
                    <th>Property Name</th>
                    <th>Property Value</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="CodeFont">yarn.nodemanager.aux-services.spark_shuffle.class</td>
                    <td class="CodeFont">org.apache.spark.network.yarn.YarnShuffleService</td>
                </tr>
                <tr>
                    <td class="CodeFont">yarn.nodemanager.aux-services</td>
                    <td class="CodeFont">mapreduce_shuffle,spark_shuffle</td>
                </tr>
            </tbody>
        </table>
        <p>to each of these YARN settings:</p>
        <ul>
            <li>Yarn Service Advanced Configuration Snippet (Safety Valve) for yarn-site.xml</li>
            <li>Yarn Client Advanced Configuration Snippet (Safety Valve) for yarn-site.xml</li>
            <li>NodeManager Advanced Configuration Snippet (Safety Valve) for yarn-site.xml</li>
            <li>ResourceManager Advanced Configuration Snippet (Safety Valve) for yarn-site.xml</li>
        </ul>
        <h3 id="hbaseupd">HBase Updates</h3>
        <p>Make these changes to the <a href="onprem_install_cloudera.html#Configur3">HBase Configuration</a>:</p>
        <ul>
            <li>Apply the 2.5 <a href="onprem_install_cloudera.html#Configur3">Java Configuration Options for HBASE Master</a> to your configuration.</li>
            <li>Set <span class="CodeFont">Maximum Number of HStoreFiles Compaction = 7</span>.</li>
        </ul>
        <p>Make these **temporary** changes to your Hbase Configuration:</p>
        <ul>
            <li>Set <span class="CodeFont">Maximum HBase Client Retries</span> to <span class="CodeFont">400</span>.</li>
            <li>Set <span class="CodeFont">RPC Timeout</span> to <span class="CodeFont">40</span>.</li>
        </ul>
        <div class="NoteIcon">Undo these temporary changes after the upgrade has completed.</div>
        <h3>Recovering from Upgrade Issues</h3>
        <p>If your upgrade from version 2.0 to version 2.5 fails, you can recover by following these steps:</p>
        <ol>
            <li>Stop all services in CM.</li>
            <li>Deactivate the Splice Machine CDH parcel.</li>
            <li>Remove the Splice Machine CDH parcel.</li>
            <li>Delete the Splice Machine CDH parcel.</li>
            <li>Download the Splice Machine 2.0 CDH parcel</li>
            <li>Distribute the Splice Machine 2.0 CDH parcel to all nodes.</li>
            <li>Activate the Splice Machine 2.0 CDH parcel.</li>
        </ol>
    </div>
</section>
