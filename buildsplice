#!/bin/sh

echo ""
echo "------------------------------------------------------------------------"
echo "---                                                                  ---"
echo "---   IF YOU'VE CHANGED THE SIDEBAR, BEFORE RUNNING THIS YOU MUST:   ---"
echo "---      1. Start the web locally                                    ---"
echo "---      2. Capture the output of Generate_PageNav_Yaml.html page    ---"
echo "---      3. Paste that output into data/pagenextprev_nav.yml         ---"
echo "---                                                                  ---"
echo "------------------------------------------------------------------------"
echo ""

PS3="Select which Docs Version to build: "
COLUMNS=12
OPTIONS=( 'DocsDev 3.0'
          'DocsTest 3.0'
          'DocsTest 2.8'
          'DocsTest 2.7'
          'Doc 3.0'
          'Doc 2.8'
          'Doc 2.7'
          'Doc 2.5' )
select opt in "${OPTIONS[@]}"; do
    case $opt in
        'DocsDev 3.0')
            version='docsdev'
            branch='3.0'
            smap='sitemapgen'
            break;
            ;;
        'DocsTest 3.0')
            version='docstest'
            branch='3.0'
            smap='sitemapgen'
            break;
            ;;
        'DocsTest 2.8')
            version='docstest'
            branch='2.8'
            smap='sitemapgen'
            break;
            ;;
        'DocsTest 2.7')
            version='docstest'
            branch='2.7'
            smap='sitemapgen.2.7'
            break;
            ;;
        'Doc 3.0')
            version='doc'
            branch='3.0'
            smap='sitemapgen'
            break;
            ;;
        'Doc 2.8')
            version='doc'
            branch='2.8'
            smap='sitemapgen'
            break;
            ;;
        'Doc 2.7')
            version='doc'
            branch='2.7'
            smap='sitemapgen2.7'
            break;
            ;;
        'Doc 2.5')
            version='doc'
            branch='2.5'
            smap='sitemapgen.2.5'
            break;
            ;;
        *) echo Invalid option;;
    esac
done

echo ""
echo "  --> Building with _config.yml,_config_$version.yml,_config_$branch.yml"
echo "       - Will generate sitemap file: _site/sitemap.$branch.xml"
echo "       - Will rename sitemap index file sitemapindex.$version.xml to _site/sitemap.index.xml"
echo ""

jekyll build --config=_config.yml,_config_$version.yml,_config_$branch.yml

# When generating a current or test version, we:
#   a. need to move the sitemap generated by jekyll (in _site/sitemapgen.xml) to the name of the branch sitemap
#   b. need to copy the sitemap index file (links to each sitemap) to _site/sitemap.index.xml

mv _site/$smap.xml _site/sitemap.$branch.xml

cp sitemapindex.$version.xml _site/sitemap.index.xml

echo "done"

say -v Fiona "$version $branch Build Done"
