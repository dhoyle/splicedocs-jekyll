<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="The Splice Machine MapReduce API provides a simple programmatic interface for using MapReduce with HBase and taking advantage of the transactional capabiliti...">
<meta name="keywords" content=" ">
<title>Splice Machine MapReduce API | Splice Machine Documentation</title>
<link rel="stylesheet" href="css/syntax.css">


<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="css/modern-business.css">
<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<!--<link rel="stylesheet" href="css/lavish-bootstrap.css"> -->
<!--<link rel="stylesheet" href="css/customstyles.css"> -->
<link rel="stylesheet" href="css/splicemain.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4000/feed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> Splice Machine Documentation</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li>
                <!-- entries without drop-downs appear here -->
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Splice Machine<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="index.html">Welcome</a></li>
                        
                        
                        
                        <li><a href="tutorials_intro.html">Tutorials</a></li>
                        
                        
                        
                        <li><a href="sqlref_intro.html">SQL Reference Manual</a></li>
                        
                        
                        
                        <li><a href="developers_intro.html">Developer's Manual</a></li>
                        
                        
                        
                        <li><a href="releasenotes_intro.html">Release Notes</a></li>
                        
                        
                        
                        <li><a href="notes_intro.html">Other Notes</a></li>
                        
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">DB-Service Only<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="dbaas_intro.html">Welcome!</a></li>
                        
                        
                        
                        <li><a href="dbaas_cm_intro.html">Cloud Manager Guide</a></li>
                        
                        
                        
                        <li><a href="dbaas_zep_intro.html">Using Zeppelin</a></li>
                        
                        
                        
                        <li><a href="dbaas_dbconsole_intro.html">Using the DB Console</a></li>
                        
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">On-Premise-DB Only<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="onprem_intro.html">Welcome!</a></li>
                        
                        
                        
                        <li><a href="onprem_install_intro.html">Installation</a></li>
                        
                        
                        
                        <li><a href="cmdlineref_intro.html">splice> Command Line Reference</a></li>
                        
                        
                        
                        <li><a href="onprem_admin_intro.html">Administrator's Guide</a></li>
                        
                        
                    </ul>
                </li>
                
                
                
			<li>



  <a class="email" title="Submit feedback" href="#" onclick="javascript:window.location='mailto:docs@splicemachine.com?subject=Splice Machine documentation feedback&body=I have some feedback about the Splice Machine MapReduce API page: ' + window.location.href;"><i class="fa fa-envelope-o"></i> Feedback</a>

</li>

		
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Splice Machine MapReduce API">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container-fluid">
    <div class="col-lg-12">&nbsp;</div>
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                

<ul id="mysidebar" class="nav">
    <li class="sidebarTitle">Splice Machine 2.6.1</li>
    
    
    
    <li>
        <a href="#">Developer's Guide</a>
        <ul>
            
            
            
            <li><a href="developers_intro.html">Introduction</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">Fundamentals</a>
        <ul>
            
            
            
            <li><a href="developers_fundamentals_intro.html">Introduction</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_transactions.html">Running Transactions</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_dates.html">Working with Date and Time Values</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_triggers.html">Using Database Triggers</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_foreignkeys.html">Using Foreign Keys</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_windowfcns.html">Using Window Functions</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_temptables.html">Using Temporary Tables</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_auth.html">Roles and Authorization</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_sparklibs.html">Using Spark Libraries</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_plsql.html">Using SplicePlus - PL/SQL</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_vti.html">Using the Virtual Table Interface</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_externaltables.html">Using External Tables</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_hcatalog.html">Using HCatalog</a></li>
            
            
            
            
            
            
            <li class="active"><a href="developers_fundamentals_mapreduce.html">Using the MapReduce API</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_hbase.html">Working with HBase</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">Functions and Stored Procedures</a>
        <ul>
            
            
            
            <li><a href="developers_fcnsandprocs_intro.html">Introduction</a></li>
            
            
            
            
            
            
            <li><a href="developers_fcnsandprocs_writing.html">Writing Functions and Stored Procedures</a></li>
            
            
            
            
            
            
            <li><a href="developers_fcnsandprocs_storing.html">Storing/Updating Functions and Procs</a></li>
            
            
            
            
            
            
            <li><a href="developers_fcnsandprocs_examples.html">Examples</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">Ingesting and Streaming Data</a>
        <ul>
            
            
            
            <li><a href="tutorials_ingest_intro.html">Introduction</a></li>
            
            
            
            
            
            
            <li><a href="tutorials_ingest_uploadtos3.html">Uploading Data to an S3 Bucket</a></li>
            
            
            
            
            
            
            <li><a href="tutorials_ingest_configures3.html">Configuring an S3 Bucket</a></li>
            
            
            
            
            
            
            <li><a href="tutorials_ingest_tpch1.html">Importing TPCH Data</a></li>
            
            
            
            
            
            
            <li><a href="tutorials_ingest_importing.html">Importing Your Data</a></li>
            
            
            
            
            
            
            <li><a href="tutorials_ingest_hfiles.html">Importing Data as HFiles</a></li>
            
            
            
            
            
            
            <li><a href="tutorials_ingest_kafkaproducer.html">Kafka - Creating a Producer</a></li>
            
            
            
            
            
            
            <li><a href="tutorials_ingest_kafkafeed.html">Kafka - Configuring a Feed</a></li>
            
            
            
            
            
            
            <li><a href="tutorials_ingest_mqttSpark.html">MQTT Spark Streaming</a></li>
            
            
            
            
            
            
            <li><a href="tutorials_ingest_storm.html">Apache Storm and Splice Machine</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">Analytics and Machine Learning</a>
        <ul>
            
            
            
            <li><a href="tutorials_ml_intro.html">Introduction</a></li>
            
            
            
            
            
            
            <li><a href="tutorials_ml_zeppelin.html">Using Apache Zeppelin</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">Tuning and Debugging</a>
        <ul>
            
            
            
            <li><a href="developers_tuning_intro.html">Introduction</a></li>
            
            
            
            
            
            
            <li><a href="developers_tuning_queryoptimization.html">Optimizing Queries</a></li>
            
            
            
            
            
            
            <li><a href="developers_tuning_usingstats.html">Using Statistics</a></li>
            
            
            
            
            
            
            <li><a href="developers_tuning_explainplan.html">Using Explain Plan</a></li>
            
            
            
            
            
            
            <li><a href="developers_tuning_explainplan_examples.html">Explain Plan Examples</a></li>
            
            
            
            
            
            
            <li><a href="developers_tuning_logging.html">Logging</a></li>
            
            
            
            
            
            
            <li><a href="developers_tuning_debugging.html">Debugging</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">Spark Console</a>
        <ul>
            
            
            
            <li><a href="sparkconsole_intro.html">Introduction</a></li>
            
            
            
            
            
            
            <li><a href="sparkconsole_features.html">Features</a></li>
            
            
            
            
            
            
            <li><a href="sparkconsole_queries.html">Managing Queries</a></li>
            
            
            
            
        </ul>
     </li>
       
        
        
        <!-- if you aren't using the accordion, uncomment this block:
           <p class="external">
               <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
           </p>
           -->
</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            <div class="post-header">
 <h2>&#160;</h2><!--  <h1 class="post-title-main">Splice Machine MapReduce API</h1>  -->
</div>



<div class="post-content">

<!--- Don't automatically put page summary at top - GRH 05/2017 --
   
    <div class="summary">The Splice Machine MapReduce API provides a simple programmatic interface for using MapReduce with HBase and taking advantage of the transactional capabilities that Splice Machine provides.</div>
   
-->

    


    

  	<section>
		<div class="TopicContent">
            <h1 id="kanchor204">Splice Machine Map Reduce API</h1>
            <div class="noteOnPremiseOnly">This topic only applies to our on-premise database product. Our database as a service does include our MapReduce API.</div>
            <p>The Splice Machine MapReduce API&#160;provides a simple programming interface to the Map Reduce Framework that is integrated into Splice Machine. You can use MapReduce to import data, export data, or for purposes such as implementing machine learning algorithms. One likely scenario for using the Splice Machine MapReduce API is for customers who already have a Hadoop cluster, want to use Splice Machine as their transactional database, and need to continue using their batch MapReduce jobs.</p>
            <p>This topic includes a summary of the Java classes included in the API,&#160;and <a href="#Example">presents an example</a> of using the MapReduce API.</p>
            <h2>Splice Machine MapReduce API&#160;Classes</h2>
            <p>The Splice Machine MapReduce API&#160;includes the following key classes:</p>
            <table summary="Descriptions of the key classes in the Splie Machine MapReduce API.">
                <col />
                <col />
                <thead>
                    <tr>
                        <th>Class</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="CodeFont">SpliceJob</td>
                        <td>Creates a transaction for the MapReduce job.</td>
                    </tr>
                    <tr>
                        <td class="CodeFont">SMInputFormat</td>
                        <td>
                            <p class="noSpaceAbove">Creates an object that:</p>
                            <ul>
                                <li value="1"> uses Splice Machine to scan the table and decode the data</li>
                                <li value="2">returns an <span class="CodeFont">ExecRow</span> (typed data) object</li>
                            </ul>
                        </td>
                    </tr>
                    <tr>
                        <td class="CodeFont">SMOutputFormat</td>
                        <td>
                            <p class="noSpaceAbove">Creates an object that:</p>
                            <ul>
                                <li value="1"> writes to a buffered cache</li>
                                <li value="2">dumps the cache into Splice Machine </li>
                                <li value="3">returns an <span class="CodeFont">ExecRow</span> (typed data)&#160;object.</li>
                            </ul>
                        </td>
                    </tr>
                    <tr>
                        <td class="CodeFont">SpliceMapReduceUtil</td>
                        <td>A Helper class for writing MapReduce jobs in java; this class is used to initiate a mapper job or a reducer job, to set the number of reducers, and to add dependency jars.</td>
                    </tr>
                </tbody>
            </table>
            <div class="noteNote">Each transaction must manage its own commit and rollback operations.</div>
            <p>For information about and examples of using Splice Machine with HCatalog, see the Using Splice Machine with HCatalog topic in this book.</p>
            <h2 id="Example">Example of Using the Splice Machine MapReduce API</h2>
            <p>This topic describes using the Splice Machine MapReduce API, <span class="CodeFont">com.splicemachine.mrio.api</span>, a simple word count program that retrieves data from an input table, summarizes the count of initial character of each word, and writes the result to an output table.</p>
            <div class="opsStepsList">
                <ol class="boldFont">
                    <li value="1">
                        <p class="topLevel">Define your input and output tables:</p>
                        <p class="indentLevel1">First, assign the name of the Splice Machine database table from which you want to retrieve data to a variable, and then assign a name for your output table to another variable:</p>
                        <p class="indentLevel1">
                            <div class="preWrapperWide"><pre class="Example" xml:space="preserve">
String inputTableName  = "WIKIDATA";
String outputTableName = "USERTEST";</pre>
                            </div>
                        </p>
                        <p class="indentLevel1">You can specify table names using the <span class="ItalicFont">&lt;schemaName&gt;.&lt;tableName&gt;</span> format; if you don't specify a schema name, the default schema is assumed.</p>
                    </li>
                    <li value="2">
                        <p class="topLevel">Create a new job instance:</p>
                        <p class="indentLevel1">You need to create a new job instance and assign a name to it:</p>
                        <p class="indentLevel1">
                            <div class="preWrapperWide"><pre class="Example" xml:space="preserve">
Configuration config = HBaseConfiguration.create();
Job job = new Job(config, "WordCount");</pre>
                            </div>
                        </p>
                    </li>
                    <li value="3">
                        <p class="topLevel">Initialize your mapper job:</p>
                        <p class="indentLevel1">We initialize our sample job using the <span class="CodeFont">initTableMapperJob</span> utility method:</p>
                        <div class="preWrapperWide"><pre class="Example">TableMapReduceUtil.initTableMapperJob(
    tableName,			// input Splice Machine database table
    scan,			// a scan instance to control CF&#160;and attribute selection
    MyMapper.class,		// the mapper
    Text.class,			// the mapper output key
    InitWritable.class,		// the mapper output value
    job,
    true,
    SpliceInputFormat.class);</pre>
                        </div>
                    </li>
                    <li value="4">
                        <p class="topLevel">Retrieve values within your map function:</p>
                        <p class="indentLevel1">Our sample <span class="CodeFont">map</span> function retrieves and parses a single row with specified columns. </p>
                        <div class="preWrapperWide"><pre class="Example">public void map(ImmutableBytesWritable row, ExecRow value, Context context)
                throws InterruptedException, IOException {
    if(value != null) {
        try {
            DataValueDescriptor dataValDesc[]  = value.getRowArray();
            if(dataValDesc[0] != null) {}
            word = dataValDesc[0].getString();
            }
        catch (StandardException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        }
        if(word != null) {
            Text key = new Text(word.charAt(0)+"");
            IntWritable val = new IntWritable(1);
            context.write(key, val);
        }
    }
}</pre>
                        </div>
                    </li>
                    <li value="5">
                        <p class="topLevel">Manipulate and save the value with reduce function:</p>
                        <p class="indentLevel1">Our sample <span class="CodeFont">reduce</span> function manipulates and saves the value by creating an <span class="CodeFont">ExecRow</span> and filling in the row with the <span class="CodeFont">execRow.setRowArray</span> method. </p>
                        <div class="preWrapperWide"><pre class="Example">public void reduce(Text key, Iterable‹IntWritable&gt; values, Context context)
                    throws IOException, InterruptedException {

    Iterator‹IntWritable&gt; it=values.iterator();
    ExecRow execRow = new ValueRow(2);
    int sum = 0;
    String word = key.toString();
    while (it.hasNext()) {		  
        sum += it.next().get();
    }
    try{
        DataValueDescriptor []dataValDescs= {new SQLVarchar(word), new SQLInteger(sum)};
        execRow.setRowArray(dataValDescs);
        context.write(new ImmutableBytesWritable(Bytes.toBytes(word)), execRow);		  
    } 
    catch(Exception E) {
        E.printStackTrace();
    }	  
}</pre>
                        </div>
                    </li>
                    <li value="6">
                        <p class="topLevel">Commit or rollback the job:</p>
                        <p class="indentLevel1">If the job is successful, commit the transaction. </p>
                        <div class="preWrapper"><pre class="Example" xml:space="preserve">job.commit();</pre>
                        </div>
                        <p class="indentLevel1">If the job fails, roll back the transaction. </p>
                        <div class="preWrapper"><pre class="Example" xml:space="preserve">job.rollback();</pre>
                        </div>
                    </li>
                </ol>
            </div>
        </div>
	</section>


    <div class="tags">
        
    </div>



</div>

<hr class="shaded"/>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2017 Splice Machine, Inc. All rights reserved. <br />
 Site last generated: Jun 21, 2017 <br />
<p><img src="images/company_logo.png" alt="Company logo"/></p>
                </div>
            </div>
</footer>


        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
    </div>

</body>

<!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-35630173-2','auto');ga('require','displayfeatures');ga('send','pageview');</script>


</html>
