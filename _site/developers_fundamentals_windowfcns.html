<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="A quick summary of window functions, as implemented in Splice Machine SQL.">
<meta name="keywords" content=" window functions, grouping, partition, default value">
<title>Splice Machine Window Functions | Splice Machine Documentation</title>
<meta class="swiftype" name="title" data-type="string" content="Splice Machine Window Functions">
<meta class="swiftype" name="info" data-type="string" content="A quick summary of window functions, as implemented in Splice Machine SQL.">
<meta class="swiftype" name="buildversion" data-type="enum" content="2.7.0">

<link rel="stylesheet" href="css/syntax.css">


<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="css/modern-business.css">
<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<!--<link rel="stylesheet" href="css/lavish-bootstrap.css"> -->
<!--<link rel="stylesheet" href="css/customstyles.css"> -->
<link rel="stylesheet" href="css/splicemain.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4006/feed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container-fluid topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> Splice Machine Internal Docs</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li>
                <!-- entries without drop-downs appear here -->
                
                    
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                   
                      <li class="dropdown">
                          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Splice Machine<b class="caret"></b></a>
                          <ul class="dropdown-menu">
                             
                                
                                   <li><a href="index.html">Welcome</a></li>
                               
                             
                                
                                   <li><a href="tutorials_intro.html">Tutorials</a></li>
                               
                             
                                
                                   <li><a href="sqlref_intro.html">SQL Reference Manual</a></li>
                               
                             
                                
                                   <li><a href="developers_intro.html">Developer's Manual</a></li>
                               
                             
                                
                                   <li><a href="cmdlineref_intro.html">Command Line Reference</a></li>
                               
                             
                                
                                   <li><a href="dbconsole_intro.html">Database Console</a></li>
                               
                             
                                
                                   <li><a href="notes_intro.html">General Information</a></li>
                               
                             
                          </ul>
                      </li>
                   
                      <li class="dropdown">
                          <a href="#" class="dropdown-toggle" data-toggle="dropdown">DB-Service Only<b class="caret"></b></a>
                          <ul class="dropdown-menu">
                             
                                
                                   <li><a href="dbaas_intro.html">Welcome!</a></li>
                               
                             
                                
                                   <li><a href="dbaas_cm_intro.html">Cloud Manager Guide</a></li>
                               
                             
                                
                                   <li><a href="dbaas_zep_intro.html">Using Zeppelin</a></li>
                               
                             
                                
                                   <li><a href="dbaas_info_troubleshoot.html">Troubleshooting/Best Practices</a></li>
                               
                             
                                
                                   <li><a href="dbaas_info_intro.html">Release Information</a></li>
                               
                             
                          </ul>
                      </li>
                   
                      <li class="dropdown">
                          <a href="#" class="dropdown-toggle" data-toggle="dropdown">On-Premise-DB Only<b class="caret"></b></a>
                          <ul class="dropdown-menu">
                             
                                
                                   <li><a href="onprem_intro.html">Welcome!</a></li>
                               
                             
                                
                                   <li><a href="onprem_install_intro.html">Installation</a></li>
                               
                             
                                
                                   <li><a href="onprem_admin_intro.html">Administrator's Guide</a></li>
                               
                             
                                
                                   <li><a href="onprem_info_troubleshoot.html">Troubleshooting/Best Practices</a></li>
                               
                             
                                
                                   <li><a href="onprem_info_intro.html">Release Information</a></li>
                               
                             
                          </ul>
                      </li>
                   
                

                <!-- If building the docsdev version, do not include Swiftype search box -->
                
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container-fluid">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                

<ul id="mysidebar" class="nav">
    <li class="sidebarTitle">Splice Machine Dev v2.7.0</li>
    
    
    
    <li>
        <a href="#">Developer's Guide</a>
        <ul>
            
            
            
            <li><a href="developers_intro.html">Introduction</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">Fundamentals</a>
        <ul>
            
            
            
            <li><a href="developers_fundamentals_intro.html">Introduction</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_transactions.html">Running Transactions</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_dates.html">Working with Date and Time Values</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_triggers.html">Using Database Triggers</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_foreignkeys.html">Using Foreign Keys</a></li>
            
            
            
            
            
            
            <li class="active"><a href="developers_fundamentals_windowfcns.html">Using Window Functions</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_temptables.html">Using Temporary Tables</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_auth.html">Roles and Authorization</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_sparklibs.html">Using Spark Libraries</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_vti.html">Using the Virtual Table Interface</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_externaltables.html">Using External Tables</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_hcatalog.html">Using HCatalog</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_mapreduce.html">Using the MapReduce API</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_hbase.html">Working with HBase</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">Functions and Stored Procedures</a>
        <ul>
            
            
            
            <li><a href="developers_fcnsandprocs_intro.html">Introduction</a></li>
            
            
            
            
            
            
            <li><a href="developers_fcnsandprocs_writing.html">Writing Functions and Stored Procedures</a></li>
            
            
            
            
            
            
            <li><a href="developers_fcnsandprocs_storing.html">Storing/Updating Functions and Procs</a></li>
            
            
            
            
            
            
            <li><a href="developers_fcnsandprocs_examples.html">Examples</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">Ingesting and Streaming Data</a>
        <ul>
            
            
            
            <li><a href="tutorials_ingest_intro.html">Introduction</a></li>
            
            
            
            
            
            
            <li><a href="tutorials_ingest_uploadtos3.html">Uploading Data to an S3 Bucket</a></li>
            
            
            
            
            
            
            <li><a href="tutorials_ingest_configures3.html">Configuring an S3 Bucket</a></li>
            
            
            
            
            
            
            <li><a href="tutorials_ingest_importoverview.html">Importing Data Tutorial</a></li>
            
            
            
            
            
            
            <li><a href="tutorials_ingest_kafkaproducer.html">Kafka - Creating a Producer</a></li>
            
            
            
            
            
            
            <li><a href="tutorials_ingest_kafkafeed.html">Kafka - Configuring a Feed</a></li>
            
            
            
            
            
            
            <li><a href="tutorials_ingest_mqttSpark.html">MQTT Spark Streaming</a></li>
            
            
            
            
            
            
            <li><a href="tutorials_ingest_storm.html">Apache Storm and Splice Machine</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">Analytics and Machine Learning</a>
        <ul>
            
            
            
            <li><a href="tutorials_ml_intro.html">Introduction</a></li>
            
            
            
            
            
            
            <li><a href="tutorials_ml_zeppelin.html">Using Apache Zeppelin</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">Tuning and Debugging</a>
        <ul>
            
            
            
            <li><a href="developers_tuning_intro.html">Introduction</a></li>
            
            
            
            
            
            
            <li><a href="developers_tuning_queryoptimization.html">Optimizing Queries</a></li>
            
            
            
            
            
            
            <li><a href="developers_tuning_usingstats.html">Using Statistics</a></li>
            
            
            
            
            
            
            <li><a href="developers_tuning_explainplan.html">Using Explain Plan</a></li>
            
            
            
            
            
            
            <li><a href="developers_tuning_explainplan_examples.html">Explain Plan Examples</a></li>
            
            
            
            
            
            
            <li><a href="developers_tuning_logging.html">Logging</a></li>
            
            
            
            
            
            
            <li><a href="developers_tuning_debugging.html">Debugging</a></li>
            
            
            
            
            
            
            <li><a href="developers_tuning_snapshots.html">Using Snapshots</a></li>
            
            
            
            
        </ul>
     </li>
       
        
        
        <!-- if you aren't using the accordion, uncomment this block:
           <p class="external">
               <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
           </p>
           -->
</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            

<div class="post-content">

<!--- Don't automatically put page summary at top - GRH 05/2017:
   
    <div class="summary">A quick summary of window functions, as implemented in Splice Machine SQL.</div>
   
-->

    


    

  <section>
<div class="TopicContent" data-swiftype-index="true">
    <h1 id="splice-machine-window-functions">Splice Machine Window Functions</h1>

    <p>An SQL <em>window function</em> performs a calculation across a set of table
rows that are related to the current row, either by proximity in the
table, or by the value of a specific column or set of columns; these
columns are known as the <em>partition</em>.</p>

    <p>This topic provides a very quick summary of window functions, as
implemented in Splice Machine. For more general information about
SQL window functions, we recommending visiting some of the sources
listed in the <a href="#ForMoreInfo" class="selected">Additional Information</a>
section at the end of this topic.</p>

    <p>Here’s a quick example of using a window function to operate on the
following table:</p>

    <div class="indented">
<table>
                    <col />
                    <col />
                    <col />
                    <thead>
                        <tr>
                            <th>OrderID</th>
                            <th>CustomerID</th>
                            <th>Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>123</td>
                            <td>1</td>
                            <td>100</td>
                        </tr>
                        <tr>
                            <td>
                            144
                        </td>
                            <td>1</td>
                            <td>250</td>
                        </tr>
                        <tr>
                            <td>167</td>
                            <td>1</td>
                            <td>150</td>
                        </tr>
                        <tr>
                            <td>
                            202
                        </td>
                            <td>
                            1
                        </td>
                            <td>250</td>
                        </tr>
                        <tr>
                            <td>209</td>
                            <td>1</td>
                            <td>325</td>
                        </tr>
                        <tr>
                            <td>
                            224
                        </td>
                            <td>
                            1
                        </td>
                            <td>125</td>
                        </tr>
                        <tr>
                            <td>66</td>
                            <td>2</td>
                            <td>100</td>
                        </tr>
                        <tr>
                            <td>
                            94
                        </td>
                            <td>
                            2
                        </td>
                            <td>200</td>
                        </tr>
                        <tr>
                            <td>127</td>
                            <td>2</td>
                            <td>300</td>
                        </tr>
                        <tr>
                            <td>
                            444
                        </td>
                            <td>
                            2
                        </td>
                            <td>400</td>
                        </tr>
                    </tbody>
                </table>
</div>
    <p>This query will find the first Order ID for each specified Customer ID
in the above table:</p>

    <pre class="Example"><code>SELECT OrderID, CustomerID,
    FIRST_VALUE(OrderID) OVER (
        PARTITION BY CustomerID
        ORDER BY OrderID
        ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW )
AS FirstOrderID
FROM ORDERS
WHERE CustomerID IN (1,2);
</code></pre>

    <p>This works by partitioning (grouping) the selected rows by CustomerID,
ordering them for purposes of applying the function to the rows in the
partition, and then using the <code>FIRST_VALUE</code> window function to evaluate
the OrderID values in each partition and find the first value in each.
The results for our sample table are:</p>

    <div class="indented">
<table summary="Sample table results from a FIRST_VALUE operation.">
                    <col />
                    <col />
                    <col />
                    <thead>
                        <tr>
                            <th>OrderID</th>
                            <th>CustomerID</th>
                            <th>FirstOrderID</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>123</td>
                            <td>1</td>
                            <td>123</td>
                        </tr>
                        <tr>
                            <td>144</td>
                            <td>1</td>
                            <td>123</td>
                        </tr>
                        <tr>
                            <td>167</td>
                            <td>1</td>
                            <td>123</td>
                        </tr>
                        <tr>
                            <td>202</td>
                            <td>1</td>
                            <td>123</td>
                        </tr>
                        <tr>
                            <td>209</td>
                            <td>1</td>
                            <td>123</td>
                        </tr>
                        <tr>
                            <td>224</td>
                            <td>1</td>
                            <td>123</td>
                        </tr>
                        <tr>
                            <td>66</td>
                            <td>2</td>
                            <td>66</td>
                        </tr>
                        <tr>
                            <td>94</td>
                            <td>2</td>
                            <td>66</td>
                        </tr>
                        <tr>
                            <td>127</td>
                            <td>2</td>
                            <td>66</td>
                        </tr>
                        <tr>
                            <td>444</td>
                            <td>2</td>
                            <td>66</td>
                        </tr>
                    </tbody>
                </table>
</div>
    <p>See the <a href="#Window2" class="selected">Window Frames</a> section below for a
further explanation of this query.</p>

    <h2 id="about-window-functions">About Window Functions</h2>

    <p>Window functions:</p>

    <ul>
      <li>Operate on a window, or set of rows. The rows considered by a window
function are produced by the query’s <code>FROM</code> clause as filtered by its
<code>WHERE</code>, <code>GROUP BY</code>, and <code>HAVING</code> clauses, if any. This means that any
row that doesn’t meet the <code>WHERE</code> condition is not seen by a window
function.</li>
      <li>Are similar to aggregate functions, except that a window function does
not group rows into a single output row. Instead, a window function
returns a value for every row in the window. This is sometimes
referred to as tuple-based aggregation.</li>
      <li>The values are calculated from the set of rows in the window.</li>
      <li>Always contain an <code>OVER</code> clause, which determines how the rows of the
query are divided and sequenced for processing by the window function.</li>
      <li>The <code>OVER</code> clause can contain a <code>PARTITION</code> clause that specifies the
set of rows in the table that form the window, relative to the current
row.</li>
      <li>
        <p>The <code>OVER</code> clause can contain an optional <code>ORDER BY</code> clause that
specifies in which order rows are processed by the window function.
This <code>ORDER BY</code> clause is independent of the <code>ORDER BY</code> clause that
specifies the order in which rows are output.</p>

        <p>Note that the <a href="sqlref_builtinfcns_rownumber.html">ROW NUMBER</a> <strong>must
contain</strong> an <code>ORDER BY</code> clause.</p>
      </li>
      <li>The <code>OVER</code> clause can also contain an optional <em>frame clause</em> that
further restricts which of the rows in the partition are sent to the
function for evaluation.</li>
    </ul>

    <h3 id="about-windows-partitions-and-frames">About Windows, Partitions, and Frames</h3>

    <p>Using window functions can seem complicated because they involve a
number of overlapping terms, including <em>window</em>, <em>sliding window</em>,
<em>partition</em>, <em>set</em>, and <em>window frame</em>. An additional complication is
that window frames can be specified using either <em>rows</em> or <em>ranges</em>.</p>

    <p>Let’s start with basic terminology definitions:</p>

    <table summary="Window functions terminology glossary.">
                <col />
                <col />
                <thead>
                    <tr>
                        <th>Terms</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><em>window function</em></td>
                        <td>A function that operates on a set of rows and produces output for each row.</td>
                    </tr>
                    <tr>
                        <td><em>window partition</em></td>
                        <td>
                            <p>The grouping of rows within a table.</p>
                            <p>Note that window partitions retains the rows, unlike aggregates, </p>
                        </td>
                    </tr>
                    <tr>
                        <td><em>window ordering</em></td>
                        <td>The sequence of rows within each partition; this is the order in which the rows are passed to the window function for evaluation.</td>
                    </tr>
                    <tr>
                        <td><em>window frame</em></td>
                        <td>A frame of rows within a window partition, relative to the current row. The window frame is used to further restrict the set of rows operated on by a function, and is sometimes referred to as the <em>row or range</em> clause.</td>
                    </tr>
                    <tr>
                        <td><em>OVER clause</em></td>
                        <td>
                            <p>This is the clause used to define how the rows of the table are divided, or partitioned, for processing by the window function. It also orders the rows within the partition.</p>
                            <p>See the <a href="#The" class="selected">The OVER Clause</a> section below for more information.</p>
                        </td>
                    </tr>
                    <tr>
                        <td><em>partitioning clause</em></td>
                        <td>
                            <p>An optional part of an <code>OVER</code> clause that divides the rows into partitions, similar to using the <code>GROUP BY</code> clause. The default partition is all rows in the table, though window functions are generally calculated over a partition.</p>
                            <p>See the <a href="#Window" class="selected">The Partition Clause</a> section below for more information.</p>
                        </td>
                    </tr>
                    <tr>
                        <td><em>ordering clause</em></td>
                        <td>
                            <p>Defines the ordering of rows within each partition. </p>
                            <p>See the <a href="#The2" class="selected">The Order Clause</a> section below for more information.</p>
                        </td>
                    </tr>
                    <tr>
                        <td><em>frame clause</em></td>
                        <td>
                            <p>Further refines the set of rows when you include an <code>ORDER BY</code> clause in your window function specification, by allowing you to include or exclude rows or values within the ordering. </p>
                            <p>See the <a href="#Window2" class="selected">The Frame Clause</a> section below for examples and more information.</p>
                        </td>
                    </tr>
                </tbody>
            </table>
    <h3 id="The">The OVER Clause</h3>

    <p>A window function alway contains an <code>OVER</code> clause, which determines how
the rows of the query are divided, or partitioned, for processing by the
window function.</p>

    <div class="fcnWrapperWide">
      <pre><code>expression OVER( 
     [partitionClause]
     [orderClause]
     [frameClause] );
</code></pre>

    </div>
    <div class="paramList">
      <p class="paramName">expression</p>

      <p class="paramDefnFirst">Any value expression that does not itself contain window function calls.</p>

    </div>
    <p class="noteNote">When you use an <a href="sqlref_builtinfcns_windowfcnsintro.html">aggregate
function</a> such as <code>AVG</code> with an
<code>OVER</code> clause, the aggregated value is computed per partition.</p>

    <h3 id="Window">The Partition Clause</h3>

    <p>The partition clause, which is optional, specifies how the window
function is broken down over groups, in the same way that
<code>GROUP BY</code> specifies groupings for regular aggregate functions. Some
example partitions are:</p>

    <ul>
      <li>departments within an organization</li>
      <li>regions within a geographic area</li>
      <li>quarters within years for sales</li>
    </ul>

    <p class="noteNote">If you omit the partition clause, the default partition, which contains
all rows in the table, is used.However, since window functions are used
to perform calculations over subsets (partitions) of rows in a table,
you generally should specify a partition clause.</p>

    <h4 id="syntax">Syntax</h4>

    <div class="fcnWrapperWide">
      <pre class="FcnSyntax"><code>PARTITION BY expression [, ...]
</code></pre>

    </div>
    <div class="paramListNested">
      <p class="paramName">expression [,…]</p>

      <p class="paramDefnFirst">A list of expressions that define the partitioning.</p>

    </div>
    <p>If you omit this clause, there is one partition that contains all rows
in the entire table.</p>

    <p>Here’s a simple example of using the partition clause to compute the
average order amount per customer:</p>

    <pre class="Example"><code>SELECT OrderID, CustomerID, Amount,
    Avg(Amount) OVER (
        PARTITION BY CustomerID
        ORDER BY OrderID
        ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW )
AS AverageOrderAmt FROM ORDERS
WHERE CustomerID IN (1,2);
</code></pre>

    <div class="indented">
<table summary="Results table from an AVG operation.">
                    <col />
                    <col />
                    <col />
                    <col />
                    <thead>
                        <tr>
                            <th>OrderID</th>
                            <th>CustomerID</th>
                            <th>Amount</th>
                            <th>AverageOrderAmt</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>123</td>
                            <td>1</td>
                            <td>100</td>
                            <td>200</td>
                        </tr>
                        <tr>
                            <td>144</td>
                            <td>1</td>
                            <td>250</td>
                            <td>200</td>
                        </tr>
                        <tr>
                            <td>167</td>
                            <td>1</td>
                            <td>150</td>
                            <td>200</td>
                        </tr>
                        <tr>
                            <td>202</td>
                            <td>1</td>
                            <td>250</td>
                            <td>200</td>
                        </tr>
                        <tr>
                            <td>209</td>
                            <td>1</td>
                            <td>325</td>
                            <td>200</td>
                        </tr>
                        <tr>
                            <td>224</td>
                            <td>1</td>
                            <td>125</td>
                            <td>200</td>
                        </tr>
                        <tr>
                            <td>66</td>
                            <td>2</td>
                            <td>100</td>
                            <td>250</td>
                        </tr>
                        <tr>
                            <td>94</td>
                            <td>2</td>
                            <td>200</td>
                            <td>250</td>
                        </tr>
                        <tr>
                            <td>127</td>
                            <td>2</td>
                            <td>300</td>
                            <td>250</td>
                        </tr>
                        <tr>
                            <td>444</td>
                            <td>2</td>
                            <td>400</td>
                            <td>250</td>
                        </tr>
                    </tbody>
                </table>
</div>
    <h3 id="The2">The Order Clause</h3>

    <p>You can also control the order in which rows are processed by window
functions using <code>ORDER BY</code> within your <code>OVER</code> clause. This is optional,
though it is important for any ranking or cumulative functions.</p>

    <h4 id="syntax-1">Syntax</h4>

    <div class="fcnWrapperWide">
      <pre class="FcnSyntax"><code>ORDER BY expression
   [ ASC | DESC | USING operator ]   [ NULLS FIRST | NULLS LAST ]
   [, ...]
</code></pre>

    </div>
    <p class="spaceAbove">Some notes about the <code>ORDER BY</code> clause in an <code>OVER</code> clause:</p>

    <ul>
      <li>Ascending order (<code>ASC</code>) is the default ordering.</li>
      <li>If you specify <code>NULLS LAST</code>, then <code>NULL</code> values are returned last;
this is the default when you use <code>ASC</code> order.</li>
      <li>If you specify <code>NULLS FIRST</code>, then <code>NULL</code> values are returned first;
this is the default when you use <code>DESC</code> order.</li>
      <li>The <code>ORDER BY</code> clause in your <code>OVER</code> clause <em>does not</em> have to match
the order in which the rows are output.</li>
      <li>You can only specify a <em>frame clause</em> if you include an
<code>ORDER BY</code> clause in your <code>OVER</code> clause.</li>
    </ul>

    <h3 id="Window2">The Frame Clause</h3>

    <p>The optional frame clause defines which of the rows in the partition
(the <code>frame</code>) should be evaluated by the window function. You can limit
which rows in the partition are passed to the function in two ways:</p>

    <ul>
      <li>Specify a <code>ROWS</code> frame to limit the frame to a fixed number of rows
from the partition that precede or follow the current row.</li>
      <li>Specify <code>RANGE</code> to only include rows in the frame whose evaluated
value falls within a certain range of the current row’s value. This is
the default, and the current default range is <code>1</code>, which means that
only rows whose value matches that of the current row are passed to
the function.</li>
    </ul>

    <p>Some sources refer to the frame clause as the <em>Rows or Ranges</em> clause.
If you omit this clause, the default is to include all rows</p>

    <p class="noteNote">Window frames can only be used when you include an <code>ORDER BY</code> clause
within the <code>OVER</code> clause.</p>

    <h4 id="syntax-2">Syntax</h4>

    <p>This clause specifies two offsets: one determines the start of the
window frame, and the other determines the end of the window frame.</p>

    <div class="fcnWrapperWide">
      <pre class="FcnSyntax"><code>[RANGE | ROWS] frameStart |
[RANGE | ROWS] BETWEEN frameStart AND frameEnd
</code></pre>

    </div>
    <div class="paramListNested">
      <p class="paramName"><code>RANGE</code></p>

      <p class="paramDefnFirst">The frame includes rows whose values are within a specified range of the
current row’s value.</p>

      <p class="paramDefn">The range is determined by the <code>ORDER BY</code> column(s). Rows with identical
values for their <code>ORDER BY</code> columns are referred to as <em>peer rows</em>.</p>

      <p class="paramName"><code>ROWS</code></p>

      <p class="paramDefnFirst">The frame includes a fixed number of rows based on their position in the
table relative to the current row.</p>

      <p class="paramName">frameStart</p>

      <p class="paramDefnFirst">Specifies the start of the frame.</p>

      <p class="paramDefn">For <code>ROWS</code> mode, you can specify:</p>

      <blockquote>
        <div class="fcnWrapperWide">
          <pre class="FcnSyntax"><code>UNBOUNDED PRECEDING
| value PRECEDING
| CURRENT ROW
| value FOLLOWING
</code></pre>

        </div>

        <div class="paramListNested">
          <p class="paramName"><span class="CodeItalicFont">value</span></p>

          <p class="paramDefnFirst">A non-negative integer value.</p>

        </div>
      </blockquote>

      <p class="paramDefn">For <code>RANGE</code> mode, you can only specify:</p>

      <blockquote>
        <div class="fcnWrapperWide">
          <pre class="FcnSyntax"><code>CURRENT ROW
| UNBOUNDED FOLLOWING
</code></pre>

        </div>
      </blockquote>

      <p class="paramName">frameEnd</p>

      <p class="paramDefnFirst">Specifies the end of the frame. The default value is <code>CURRENT ROW</code>.</p>

      <p class="paramDefn">For <code>ROWS</code> mode, you can specify:</p>

      <blockquote>
        <div class="fcnWrapperWide">
          <pre class="FcnSyntax"><code>value PRECEDING
| CURRENT ROW
| value FOLLOWING
| UNBOUNDED FOLLOWING
</code></pre>

        </div>

        <div class="paramListNested">
          <p class="paramName"><span class="CodeItalicFont">value</span></p>

          <p class="paramDefnFirst">A non-negative integer value.</p>

        </div>
      </blockquote>

      <p class="paramDefn">For <code>RANGE</code> mode, you can only specify:</p>

      <blockquote>
        <div class="fcnWrapperWide">
          <pre class="FcnSyntax"><code>CURRENT ROW
| UNBOUNDED FOLLOWING
</code></pre>

        </div>
      </blockquote>

    </div>
    <h4 id="ranges-and-rows">Ranges and Rows</h4>

    <p class="body">Probably the easiest way to understand how <code>RANGE</code> and <code>ROWS</code> work is by
way of some simple <code>OVER</code> clause examples:</p>

    <blockquote>
      <h5 id="Example">Example 1:</h5>

      <p class="body">This clause can be used to apply a window function to all rows in the
partition from the top of the partition to the current row:</p>

      <pre class="Example"><code>OVER (PARTITION BY customerID ORDER BY orderDate)
</code></pre>

      <h5 id="example-2">Example 2:</h5>

      <p class="body">Both of these clauses specify the same set of rows as <a href="#Example" class="selected">Example
1:</a></p>

      <pre class="Example"><code>OVER (PARTITION BY customerID ORDER BY orderDate UNBOUNDED PRECEDING preceding)

OVER (PARTITION BY customerID ORDER BY orderDate RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)
</code></pre>

      <h5 id="example-3">Example 3:</h5>

      <p class="body">This clause can be used to apply a window function to the current row
and the 3 preceding row’s values in the partition:</p>

      <pre class="Example"><code>OVER (PARTITION BY customerID ORDER BY orderDate ROWS 3 preceding)
</code></pre>
    </blockquote>

    <h4 id="framestart-and-frameend">FrameStart and FrameEnd</h4>

    <p>Some important notes about the frame clause:</p>

    <ul>
      <li><code>UNBOUNDED PRECEDING</code> means that the frame starts with the first row
of the partition.</li>
      <li><code>UNBOUNDED FOLLOWING</code> means that the frame ends with the last row of
the partition.</li>
      <li>You must specify the <span class="CodeItalicFont">frameStart</span>
first and the <span class="CodeItalicFont">frameEnd</span> last within
the frame clause.</li>
      <li>In <code>ROWS</code> mode, <code>CURRENT ROW</code> means that the frame starts or ends with
the current row; in <code>RANGE</code> mode, <code>CURRENT ROW</code> means that the frame
starts or ends with the current row’s first or last peer in the
<code>ORDER BY</code> ordering.</li>
      <li>
        <p>The default <em>frameClause</em> is to include all values from the start of
the partition through the current row: </p>

        <div class="preWrapper">
          <pre class="Example"><code>RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
</code></pre>

        </div>
      </li>
    </ul>

    <h4 id="common-frame-clauses">Common Frame Clauses</h4>

    <p>When learning about window functions, you may find references to these
specific frame clause types:</p>

    <table summary="Some common frame clause examples">
                <col />
                <col />
                <thead>
                    <tr>
                        <th>Frame Clause Type</th>
                        <th>Example</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><em>Recycled</em></td>
                        <td><code>BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING</code></td>
                    </tr>
                    <tr>
                        <td><em>Cumulative</em></td>
                        <td><code>BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW</code></td>
                    </tr>
                    <tr>
                        <td><em>Rolling</em></td>
                        <td><code>BETWEEN 2 PRECEDING AND 2 FOLLOWING</code></td>
                    </tr>
                </tbody>
            </table>
    <h3 id="examples">Examples</h3>

    <p>This is a simple example that doesn’t use a frame clause:</p>

    <div class="opsStepsList">
      <ol class="boldFont">
        <li>
          <p class="topLevel">Rank each year within a player by the number of home runs hit by
that player:</p>

          <div class="preWrapperWide">

            <pre class="Example"><code>RANK() OVER (PARTITION BY playerID ORDER BY H desc);
</code></pre>

          </div>
        </li>
      </ol>

    </div>
    <p>Here are some examples of window functions using frame clauses:</p>

    <div class="opsStepsList">
      <ol class="boldFont">
        <li>
          <p class="topLevel">Compute the running sum of G for each player:</p>

          <div class="preWrapperWide">

            <pre class="Example"><code>SUM(G) OVER (PARTITION BY playerID ORDER BY yearID
  RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW);
</code></pre>

          </div>
        </li>
        <li>
          <p class="topLevel">Compute the career year:</p>

          <div class="preWrapperWide">

            <pre class="Example"><code>YearID - min(YEARID) OVER (PARTITION BY playerID
   RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) + 1;
</code></pre>

          </div>
        </li>
        <li>
          <p class="topLevel">Compute a rolling average of games by player:</p>

          <div class="preWrapperWide">

            <pre class="Example"><code>AVG(G) OVER (PARTITION BY playerID ORDER BY yearID
   ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING);
</code></pre>

          </div>
        </li>
      </ol>

    </div>
    <h2 id="The3">The Ranking Functions</h2>

    <p>A subset of our window functions are known as <em>ranking functions</em>:</p>

    <ul>
      <li class="CodeFont" value="1"><a href="sqlref_builtinfcns_denserank.html">DENSE_RANK</a><span class="bodyFont">
ranks each row in the result set. If values in the ranking column are
the same, they receive the same rank. The next number in the ranking
sequence is then used to rank the row or rows that follow, which means
that <code>DENSE_RANK</code> always returns consecutive numbers.</span></li>
      <li class="CodeFont" value="2"><a href="sqlref_builtinfcns_rank.html">RANK</a><span class="bodyFont"> ranks each
row in the result set. If values in the ranking column are the same,
they receive the same rank. However, the next number in the ranking
sequence is then skipped, which means that <code>RANK</code> can return
non-consecutive numbers.</span></li>
      <li class="CodeFont" value="3"><a href="sqlref_builtinfcns_rownumber.html">ROW NUMBER</a><span class="bodyFont">
assigns a sequential number to each row in the result set.</span></li>
    </ul>

    <p>All ranking functions <strong>must include</strong> an <code>ORDER BY</code> clause in the
<code>OVER()</code> clause, since that is how they compute ranking values.</p>

    <h2 id="window-function-restrictions">Window Function Restrictions</h2>

    <p>Because window functions are only allowed in
<a href="sqlref_clauses_orderby.html"><code>ORDER BY</code></a> clauses, and because window
functions are computed after both <code>WHERE</code> and <code>HAVING</code>, you sometimes
need to use subqueries with window functions to accomplish what seems
like it could be done in a simpler query.</p>

    <p>For example, because you cannot use an <code>OVER</code> clause in a
<code>WHERE</code> clause, a query like the following is not possible:</p>

    <div class="preWrapper">
      <pre class="Example"><code>SELECT *
FROM Batting
WHERE rank() OVER (PARTITION BY playerID ORDER BY G) = 1;
</code></pre>

    </div>
    <p>And because <code>WHERE</code> and <code>HAVING</code> are computed before the windowing
functions, this won’t work either:</p>

    <div class="preWrapper">
      <pre class="Example"><code>SELECT playerID, rank() OVER (PARTITION BY playerID ORDER BY G) as player_rank FROM Batting
WHERE player_rank = 1;
</code></pre>

    </div>
    <p>Instead, you need to use a subquery:</p>

    <div class="preWrapper">
      <pre class="Example"><code>SELECT *
FROM (
   SELECT playerID, G, rank() OVER (PARTITION BY playerID ORDER BY G) as "pos"
   FROM Batting
) tmp
WHERE "pos" = 1;
</code></pre>

    </div>
    <p>And note that the above subquery will add a rank column to the original
columns,</p>

    <h2 id="IncludedFcns">Window Functions Included in This Release</h2>

    <p>Splice Machine is currently expanding the set of SQL functions already
able to take advantage of windowing functionality.</p>

    <p>The  <a href="sqlref_clauses_over.html"><code>OVER</code></a> clause topic completes the complete reference information for <code>OVER</code>.</p>

    <p>Here is a list of the functions that currently support windowing:</p>

    <ul>
      <li class="CodeFont" value="1"><a href="sqlref_builtinfcns_avg.html">AVG</a></li>
      <li class="CodeFont" value="2"><a href="sqlref_builtinfcns_count.html">COUNT</a></li>
      <li class="CodeFont" value="3"><a href="sqlref_builtinfcns_denserank.html">DENSE_RANK</a></li>
      <li class="CodeFont" value="4"><a href="sqlref_builtinfcns_firstvalue.html">FIRST_VALUE</a></li>
      <li class="CodeFont" value="5"><a href="sqlref_builtinfcns_lag.html">LAG</a></li>
      <li class="CodeFont" value="6"><a href="sqlref_builtinfcns_lastvalue.html">LAST_VALUE</a></li>
      <li class="CodeFont" value="7"><a href="sqlref_builtinfcns_lead.html">LEAD</a></li>
      <li class="CodeFont" value="8"><a href="sqlref_builtinfcns_max.html">MAX</a></li>
      <li class="CodeFont" value="9"><a href="sqlref_builtinfcns_min.html">MIN</a></li>
      <li class="CodeFont" value="10"><a href="sqlref_builtinfcns_rank.html">RANK</a></li>
      <li class="CodeFont" value="11"><a href="sqlref_builtinfcns_rownumber.html">ROW NUMBER</a></li>
      <li class="CodeFont" value="12"><a href="sqlref_builtinfcns_sum.html">SUM</a></li>
    </ul>

    <h2 id="ForMoreInfo">Additional Information</h2>

    <p>There are numerous articles about window functions that you can find
online. Here are a few you might find valuable:</p>

    <ul>
      <li>The <a href="https://www.simple-talk.com/sql/learn-sql-server/window-functions-in-sql-server/" target="_blank">simple talk articles from Red Gate</a> about
window functions are probably the most straightforward and
comprehensive descriptions of window functions.</li>
      <li>This <a href="http://www.oracle.com/technetwork/issue-archive/2013/13-mar/o23sql-1906475.html" target="_blank">Oracle Technology Network article</a>
provides an excellent technical introduction.</li>
      <li>This <a href="http://www.postgresql.org/docs/9.1/static/tutorial-window.html" target="_blank">PostgreSQL page</a> introduces their version
of window functions and links to other pages.</li>
      <li>This <a href="https://wiki.postgresql.org/wiki/SQL2008_windowing_queries" target="_blank">PostgreSQL wiki page</a> about SQL windowing
queries page provides a succinct explanation of why windowing
functions are used, and includes several useful examples.</li>
      <li>The <a href="http://en.wikipedia.org/wiki/Select_(SQL)" target="_blank">Wikipedia SQL SELECT</a> page contains
descriptions of specific window functions and links to other pages.</li>
    </ul>

  </div>
</section>



    <div class="tags">
        
    </div>



</div>

<hr class="shaded"/>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2018 Splice Machine, Inc. All rights reserved. <br />
 Site last generated: Jan 19, 2018 <br />
<p><img src="images/company_logo.png" alt="Company logo"/></p>
                </div>
            </div>
</footer>


        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
    </div>

        <!-- Swiftype script; values depend on which built type and which build version -->

<script type="text/javascript">
(function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
(w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
})(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

_st('install','YGtH3zGt4NJzs35yCo5A','2.0.0', {
  install: {
    hooks: {
      query_filter: function(query) {
        query.setFilterDataByDocumentTypeSlugAndFilterField('page', 'buildversion', { values: ['2.7.0'], type: "and" });

        return query;
      }
    }
  }
});
</script>


</body>
    <!-- Only include analytics scripts if generating the customer docs -->


</html>
