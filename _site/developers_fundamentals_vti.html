<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="How to use the Splice Machine Virtual Table Interface (VTI) to access other data sources.">
<meta name="keywords" content=" VTI, virtual tables, table functions">
<title>Using the Splice Machine VTI | Splice Machine Documentation</title>
<meta class="swiftype" name="title" data-type="string" content="Using the Splice Machine VTI">
<meta class="swiftype" name="info" data-type="string" content="How to use the Splice Machine Virtual Table Interface (VTI) to access other data sources.">
<meta class="swiftype" name="buildversion" data-type="enum" content="2.7.0">

<link rel="stylesheet" href="css/syntax.css">


<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="css/modern-business.css">
<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<!--<link rel="stylesheet" href="css/lavish-bootstrap.css"> -->
<!--<link rel="stylesheet" href="css/customstyles.css"> -->
<link rel="stylesheet" href="css/splicemain.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4000/feed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container-fluid topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> Splice Machine Internal Docs</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li>
                <!-- entries without drop-downs appear here -->
                
                    
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                   
                      <li class="dropdown">
                          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Splice Machine<b class="caret"></b></a>
                          <ul class="dropdown-menu">
                             
                                
                                   <li><a href="index.html">Welcome</a></li>
                               
                             
                                
                                   <li><a href="tutorials_intro.html">Tutorials</a></li>
                               
                             
                                
                                   <li><a href="sqlref_intro.html">SQL Reference Manual</a></li>
                               
                             
                                
                                   <li><a href="developers_intro.html">Developer's Manual</a></li>
                               
                             
                                
                                   <li><a href="cmdlineref_intro.html">Command Line Reference</a></li>
                               
                             
                                
                                   <li><a href="dbconsole_intro.html">Database Console</a></li>
                               
                             
                                
                                   <li><a href="notes_intro.html">General Information</a></li>
                               
                             
                          </ul>
                      </li>
                   
                      <li class="dropdown">
                          <a href="#" class="dropdown-toggle" data-toggle="dropdown">DB-Service Only<b class="caret"></b></a>
                          <ul class="dropdown-menu">
                             
                                
                                   <li><a href="dbaas_intro.html">Welcome!</a></li>
                               
                             
                                
                                   <li><a href="dbaas_cm_intro.html">Cloud Manager Guide</a></li>
                               
                             
                                
                                   <li><a href="dbaas_zep_intro.html">Using Zeppelin</a></li>
                               
                             
                                
                                   <li><a href="dbaas_info_troubleshoot.html">Troubleshooting/Best Practices</a></li>
                               
                             
                                
                                   <li><a href="dbaas_info_intro.html">Release Information</a></li>
                               
                             
                          </ul>
                      </li>
                   
                      <li class="dropdown">
                          <a href="#" class="dropdown-toggle" data-toggle="dropdown">On-Premise-DB Only<b class="caret"></b></a>
                          <ul class="dropdown-menu">
                             
                                
                                   <li><a href="onprem_intro.html">Welcome!</a></li>
                               
                             
                                
                                   <li><a href="onprem_install_intro.html">Installation</a></li>
                               
                             
                                
                                   <li><a href="onprem_admin_intro.html">Administrator's Guide</a></li>
                               
                             
                                
                                   <li><a href="onprem_info_troubleshoot.html">Troubleshooting/Best Practices</a></li>
                               
                             
                                
                                   <li><a href="onprem_info_intro.html">Release Information</a></li>
                               
                             
                          </ul>
                      </li>
                   
                

                <!-- If building the docsdev version, do not include Swiftype search box -->
                
                <li>
<!-- Start Swiftype search -->
                    <div id="swiftype-search-container">
                        <form>
                          <input type="text" class="st-default-search-input swiftype-input">
                          <button type="submit" class="swiftype-submit">Search</button>
                        </form>
                    </div>
                </li>
                
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container-fluid">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                

<ul id="mysidebar" class="nav">
    
        <li class="sidebarTitle">Internal Docs v2.7.0</li>
    
    
    
    
    <li>
        <a href="#">Developer's Guide</a>
        <ul>
            
            
            
            <li><a href="developers_intro.html">Introduction</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">Fundamentals</a>
        <ul>
            
            
            
            <li><a href="developers_fundamentals_intro.html">Introduction</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_transactions.html">Running Transactions</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_dates.html">Working with Date and Time Values</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_triggers.html">Using Database Triggers</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_foreignkeys.html">Using Foreign Keys</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_windowfcns.html">Using Window Functions</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_temptables.html">Using Temporary Tables</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_auth.html">Roles and Authorization</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_sparklibs.html">Using Spark Libraries</a></li>
            
            
            
            
            
            
            <li class="active"><a href="developers_fundamentals_vti.html">Using the Virtual Table Interface</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_externaltables.html">Using External Tables</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_hcatalog.html">Using HCatalog</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_mapreduce.html">Using the MapReduce API</a></li>
            
            
            
            
            
            
            <li><a href="developers_fundamentals_hbase.html">Working with HBase</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">Functions and Stored Procedures</a>
        <ul>
            
            
            
            <li><a href="developers_fcnsandprocs_intro.html">Introduction</a></li>
            
            
            
            
            
            
            <li><a href="developers_fcnsandprocs_writing.html">Writing Functions and Stored Procedures</a></li>
            
            
            
            
            
            
            <li><a href="developers_fcnsandprocs_storing.html">Storing/Updating Functions and Procs</a></li>
            
            
            
            
            
            
            <li><a href="developers_fcnsandprocs_examples.html">Examples</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">Ingesting and Streaming Data</a>
        <ul>
            
            
            
            <li><a href="tutorials_ingest_intro.html">Introduction</a></li>
            
            
            
            
            
            
            <li><a href="tutorials_ingest_uploadtos3.html">Uploading Data to an S3 Bucket</a></li>
            
            
            
            
            
            
            <li><a href="tutorials_ingest_configures3.html">Configuring an S3 Bucket</a></li>
            
            
            
            
            
            
            <li><a href="tutorials_ingest_importoverview.html">Importing Data Tutorial</a></li>
            
            
            
            
            
            
            <li><a href="tutorials_ingest_kafkaproducer.html">Kafka - Creating a Producer</a></li>
            
            
            
            
            
            
            <li><a href="tutorials_ingest_kafkafeed.html">Kafka - Configuring a Feed</a></li>
            
            
            
            
            
            
            <li><a href="tutorials_ingest_mqttSpark.html">MQTT Spark Streaming</a></li>
            
            
            
            
            
            
            <li><a href="tutorials_ingest_storm.html">Apache Storm and Splice Machine</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">Analytics and Machine Learning</a>
        <ul>
            
            
            
            <li><a href="tutorials_ml_intro.html">Introduction</a></li>
            
            
            
            
            
            
            <li><a href="tutorials_ml_zeppelin.html">Using Apache Zeppelin</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">Tuning and Debugging</a>
        <ul>
            
            
            
            <li><a href="developers_tuning_intro.html">Introduction</a></li>
            
            
            
            
            
            
            <li><a href="developers_tuning_queryoptimization.html">Optimizing Queries</a></li>
            
            
            
            
            
            
            <li><a href="developers_tuning_usingstats.html">Using Statistics</a></li>
            
            
            
            
            
            
            <li><a href="developers_tuning_explainplan.html">Using Explain Plan</a></li>
            
            
            
            
            
            
            <li><a href="developers_tuning_explainplan_examples.html">Explain Plan Examples</a></li>
            
            
            
            
            
            
            <li><a href="developers_tuning_logging.html">Logging</a></li>
            
            
            
            
            
            
            <li><a href="developers_tuning_debugging.html">Debugging</a></li>
            
            
            
            
            
            
            <li><a href="developers_tuning_snapshots.html">Using Snapshots</a></li>
            
            
            
            
        </ul>
     </li>
       
        
        
        <!-- if you aren't using the accordion, uncomment this block:
           <p class="external">
               <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
           </p>
           -->
</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            

<div class="post-content">

<!--- Don't automatically put page summary at top - GRH 05/2017:
   
    <div class="summary">How to use the Splice Machine Virtual Table Interface (VTI) to access other data sources.</div>
   
-->

    


    

  <section>
<div class="TopicContent" data-swiftype-index="true">
    <h1 id="using-the-splice-machine-virtual-table-interface-vti">Using the Splice Machine Virtual Table Interface (VTI)</h1>

    <p>The Virtual Table Interface (VTI) allows you to use an SQL interface
with data that is external to your database. This topic introduces the
Splice Machine VTI in these sections:</p>

    <ul>
      <li><a href="#About">About VTI</a> describes the virtual table interface.</li>
      <li><a href="#Splice">Splice Machine Built-in Virtual Table Interfaces</a> describes
the virtual table interfaces built into Splice Machine, and provides
examples of using each.</li>
      <li><a href="#Creating">Creating a Custom Virtual Table Interface</a> walks you
through the steps required to create a custom virtual table interface,
and demonstrates how to simplify its use with a table function.</li>
      <li><a href="#VirtualFile">The Splice Machine Built-in VTI Classes</a> provides
reference descriptions of the virtual table interface classes built
into by Splice Machine.</li>
    </ul>

    <h2 id="About">About VTI</h2>

    <p>You can use the Splice Machine Virtual Table Interface (<em>VTI</em>) to access
data in external files, libraries, and databases.</p>

    <p class="noteNote">A virtual table is a view of data stored elsewhere; the data itself is
not duplicated in your Splice Machine database.</p>

    <p>The external data source can be any information source, including:</p>

    <ul>
      <li>XML formatted reports and logs.</li>
      <li>Queries that run in external databases that support JDBC, such as
Oracle and DB2.</li>
      <li>RSS feeds.</li>
      <li>Flat files in formats such as comma-separated value (csv) format.</li>
    </ul>

    <h3 id="about-table-functions">About Table Functions</h3>

    <p>A <em>table function</em> returns <code>ResultSet</code> values that you can query like
you do tables that live in your Splice Machine database. A table
function is bound to a constructor for a custom VTI class. Here’s an
example of a declaration for a table function that is bound to the
<code>PropertiesFileVTI</code> class, which we walk you through implementing later
in this topic:</p>

    <div class="preWrapperWide">
      <pre class="Example"><code>CREATE FUNCTION propertiesFile(propertyFilename VARCHAR(200))
    RETURNS TABLE
       (
         KEY_NAME varchar(100)
         VALUE varchar(200)
       )
    LANGUAGE JAVA
    PARAMETER STYLE SPLICE_JDBC_RESULT_SET
    READS SQL DATA
    EXTERNAL NAME 'com.splicemachine.tutorials.vti.PropertiesFIleVTI.getPropertiesFileVTI';
</code></pre>

    </div>
    <h2 id="Splice">Splice Machine Built-in Virtual Table Interfaces</h2>

    <p>Splice Machine provides two built-in VTI classes that you can use:</p>

    <table>
                <col />
                <col />
                <col />
                <thead>
                    <tr>
                        <th>Class</th>
                        <th>Description</th>
                        <th>Implemented by</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>SpliceFileVTI</code></td>
                        <td>For querying delimited flat files, such as CSV files.</td>
                        <td><code>com.splicemachine.derby.vti.SpliceFileVTI</code></td>
                    </tr>
                    <tr>
                        <td><code>SpliceJDBCVTI</code></td>
                        <td>For querying data from external sources that support the JDBC API.</td>
                        <td><code>com.splicemachine.derby.vti.SpliceJDBCVTI</code></td>
                    </tr>
                </tbody>
            </table>
    <p>Each of these classes implements the <code>DatasetProvider</code> interface, which
is used by Spark for creating execution trees, and the <code>VTICosting</code>
interface, which is used by the Splice Machine optimizer.</p>

    <h4 id="splicefilevtiexample">SpliceFileVTI Example</h4>

    <p>For example, if we have an input file named <code>vtiInfile.csv</code> that
contains this information:</p>

    <div class="preWrapperWide">
      <pre class="Example"><code>sculligan,Relief Pitcher,27,08-27-2015,2015-08-27 08:08:08,06:08:08
jpeepers,Catcher,37,08-26-2015,2015-08-21 08:09:08,08:08:08
mbamburger,Manager,47,08-25-2015,2015-08-20 08:10:08,10:08:08
gbrown,Batting Coach,46,08-24-2015,2015-08-21 08:11:08,11:08:08
jardson,Left Fielder,34,08-23-2015,2015-08-22 08:12:08,11:08:08
</code></pre>

    </div>
    <p>We can use the <code>SpliceFileVTI</code> class to select and display the contents
of our input file:</p>

    <div class="preWrapperWide">
      <pre class="Example"><code>SELECT * FROM new com.splicemachine.derby.vti.SpliceFileVTI(
  '/&lt;path&gt;/data/vtiInfile.csv','',',') AS b
   (name VARCHAR(10), title VARCHAR(30), age INT, something VARCHAR(12), date_hired TIMESTAMP, clock TIME);NAME        |TITLE             |AGE   |SOMETHING   |DATE_HIRED             |CLOCK
---------------------------------------------------------------------------------------
sculligan   |Relief Pitcher    |27    |08X-27-2015 |2015-08-27 08:08:08.0  |06:08:08
jpeepers    |Catcher           |37    |08-26-2015  |2015-08-21 08:09:08.0  |08:08:08
mbamburger  |Manager           |47    |08-25-2015  |2015-08-20 08:10:08.0  |10:08:08
gbrown      |Batting Coach     |46    |08-24-2015  |2015-08-21 08:11:08.0  |11:08:08
jardson     |Left Fielder      |34    |08-23X-2015 |2015-08-22 08:12:08.0  |11:08:08

5 rows selected
</code></pre>

    </div>
    <h4 id="splicejdbcvtiexample">SpliceJDBCVTI Example</h4>

    <p>We can use the <code>SpliceJDBCVTI</code> class to select and display the contents
a table in a JDBC-compliant database. For example, here we query a table
stored in a MySQL database:</p>

    <div class="preWrapperWide">
      <pre class="Example"><code>SELECT * FROM new com.splicemachine.derby.vti.SpliceJDBCVTI(
  'jdbc:mysql://localhost/hr?user=root&amp;password=mysql-passwd','mySchema','myTable') AS b
   (name VARCHAR(10), title VARCHAR(30), age INT, something VARCHAR(12), date_hired TIMESTAMP, clock TIME);NAME        |TITLE             |AGE   |SOMETHING   |DATE_HIRED             |CLOCK
---------------------------------------------------------------------------------------
sculligan   |Relief Pitcher    |27    |08X-27-2015 |2015-08-27 08:08:08.0  |06:08:08
jpeepers    |Catcher           |37    |08-26-2015  |2015-08-21 08:09:08.0  |08:08:08
mbamburger  |Manager           |47    |08-25-2015  |2015-08-20 08:10:08.0  |10:08:08
gbrown      |Batting Coach     |46    |08-24-2015  |2015-08-21 08:11:08.0  |11:08:08
jardson     |Left Fielder      |34    |08-23X-2015 |2015-08-22 08:12:08.0  |11:08:08

5 rows selected
</code></pre>

    </div>
    <h2 id="Creating">Creating a Custom Virtual Table Interface</h2>

    <p>You can create a custom virtual table interface by creating a class that
implements the <code>DatasetProvider</code> and <code>VTICosting</code> interfaces, which are
described below.</p>

    <p>You can then use your custom VTI within SQL queries by using VTI syntax,
as shown in the examples in the previous section. You can also create a
table function for your custom VTI, and then call that function in your
queries, which simplifies using your interface.</p>

    <p>This section walks you through creating a custom virtual table interface
that reads and displays the property keys and values in a properties
file. This interface can be executed using a table function or by
specifying its full method name in SQL statements.</p>

    <p class="noteIcon">The full code for this example is in the Splice <a href="https://github.com/splicemachine/splice-community-sample-code" target="_blank">Community Sample Code
Repository on Github.</a></p>

    <p>The remainder of this section is divided into these subsections:</p>

    <ul>
      <li><a href="#Declare">Declare Your Class</a></li>
      <li><a href="#Implemen">Implement the Constructors</a></li>
      <li><a href="#Implemen2">Implement Your Method to Generate Results</a></li>
      <li><a href="#Implemen3">Implement Costing Methods</a></li>
      <li><a href="#Implemen4">Implement Other DatasetProvider Methods</a></li>
      <li><a href="#Use">Use Your Custom Virtual Table Interface</a></li>
    </ul>

    <h3 id="Declare">Declare Your Class</h3>

    <p class="body">The first thing you need to do is to declare your public class; since
we’re creating an interface to read property files, we’ll call our class
<code>PropertiesFileVTI</code>. To create a custom VTI interface, you need to
implement the following classes:</p>

    <table>
                <col />
                <col />
                <thead>
                    <tr>
                        <th>Class</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>DatasetProvider</code></td>
                        <td>Used by Spark to construct execution trees.</td>
                    </tr>
                    <tr>
                        <td><code>VTICosting</code></td>
                        <td>Used by the Splice Machine optimizer to estimate the cost of operations.</td>
                    </tr>
                </tbody>
            </table>
    <p class="body">Here’s the declaration:</p>

    <div class="preWrapperWide">

      <pre class="Example"><code>public class PropertiesFileVTI implements DatasetProvider, VTICosting {

    //Used for logging (and optional)
    private static final Logger LOG = Logger.getLogger(PropertiesFileVTI.class);

    //Instance variable that will store the name of the properties file that is being read
    private String fileName;

    //Provide external context which can be carried with the operation
    protected OperationContext operationContext;
</code></pre>

    </div>
    <h3 id="Implemen">Implement the Constructors</h3>

    <p class="body">This section describes the constructors that we implement for our custom
class:</p>

    <ul>
      <li>
        <p>You need to implement an empty constructor if you want to use your
class in table functions:</p>

        <div class="preWrapperWide">
          <pre class="Example"><code>public PropertiesFileVTI()
</code></pre>

        </div>
      </li>
      <li>
        <p>This is the signature used by invoking the VTI using the class name in
SQL queries:</p>

        <div class="preWrapperWide">
          <pre class="Example"><code>public PropertiesFileVTI(String pfileName)
</code></pre>

        </div>
      </li>
      <li>
        <p>This static constructor is called by the VTI - Table Function.</p>

        <div class="preWrapperWide">
          <pre class="Example"><code>public static DatasetProvider getPropertiesFileVTI(String fileName)
</code></pre>

        </div>
      </li>
    </ul>

    <p class="body">Here’s our implementation of the constructors for the
<code>PropertiesFileVTI</code> class:</p>

    <div class="preWrapperWide">

      <pre class="Example"><code>public PropertiesFileVTI() {}
public PropertiesFileVTI(String pfileName) {
    this.fileName = pfileName;
}

public static DatasetProvider getPropertiesFileVTI(String fileName) {
    return new PropertiesFileVTI(fileName);
}
</code></pre>

    </div>
    <h3 id="Implemen2">Implement Your Method to Generate Results</h3>

    <p class="body">The heart of your virtual table interface is the <code>DatasetProvider</code>
method <code>getDataSet</code>, which you override to generate and return a
<code>DataSet</code>. It’s declaration looks like this:</p>

    <div class="preWrapperWide">
      <pre class="Example"><code>DataSet&lt;LocatedRow&gt; getDataSet(
        SpliceOperation op,       // References the op at the top of the stack
        DataSetProcessor dsp,     // Mechanism for constructing the execution tree
        ExecRow execRow ) throws StandardException;
</code></pre>

    </div>
    <p class="body">The <code>VTIOperation</code> process calls this method to compute the <code>ResultSet</code>
that it should return. Our <code>PropertiesFileVTI</code> implementation is shown
here:</p>

    <div class="preWrapperWide">
      <pre class="Example"><code>@Override
public DataSet&lt;LocatedRow&gt; getDataSet(SpliceOperation op, DataSetProcessor dsp, ExecRow execRow) throws StandardException {
    operationContext = dsp.createOperationContext(op);

        //Create an arraylist to store the key-value pairs
    ArrayList&lt;LocatedRow&gt; items = new ArrayList&lt;LocatedRow&gt;();

    try {
        Properties properties = new Properties();

        //Load the properties file
        properties.load(getClass().getClassLoader().getResourceAsStream(fileName));

        //Loop through the properties and create an array
        for (String key : properties.stringPropertyNames()) {
            String value = properties.getProperty(key);
            ValueRow valueRow = new ValueRow(2);
            valueRow.setColumn(1, new SQLVarchar(key));
            valueRow.setColumn(2, new SQLVarchar(value));
            items.add(new LocatedRow(valueRow));
        }
    } catch (FileNotFoundException e) {
        LOG.error("File not found: " + this.fileName, e);
    } catch (IOException e) {
        LOG.error("Unexpected IO Exception: " + this.fileName, e);
    } finally {
        operationContext.popScope();
    }
    return new ControlDataSet&lt;&gt;(items);
}
</code></pre>

    </div>
    <h3 id="Implemen3">Implement Costing Methods</h3>

    <p class="body">The Splice Machine optimizer uses costing estimates to determine the
optimal execution plan for each query. You need to implement several
costing methods in your VTI class:</p>

    <ul>
      <li>
        <p><code>getEstimatedCostPerInstantiation</code> returns the estimated cost to
instantiate and iterate through your table function. Unless you have
an accurate means of estimating this cost, simply return <code>0</code> in your
implementation.</p>

        <div class="preWrapperWide">
          <pre class="Example"><code>public double getEstimatedCostPerInstantiation( VTIEnvironment vtiEnv) throws SQLException;
</code></pre>

        </div>
      </li>
      <li>
        <p><code>getEstimatedRowCount</code> returns the estimated row count for a single
scan of your table function. Unless you have an accurate means of
estimating this cost, simply return <code>0</code> in your implementation.</p>

        <div class="preWrapperWide">
          <pre class="Example"><code>public double getEstimatedCostPerInstantiation( VTIEnvironment vtiEnv) throws SQLException;
</code></pre>

        </div>
      </li>
      <li>
        <p><code>supportsMultipleInstantiations</code> returns a Boolean value indicating
whether your table function’s <code>ResultSet</code> can be instantiated multiple
times in a single query. For our <code>PropertiesFileVTI</code> implementation of
this method, we simply return <code>False</code>, since there’s no reason for our
function to be used that way.</p>

        <div class="preWrapperWide">
          <pre class="Example"><code>public double supportsMultipleInstantiations( VTIEnvironment vtiEnv) throws SQLException;
</code></pre>

        </div>
      </li>
    </ul>

    <p class="noteNote">The VTICosting methods each take a <code>VTIEnvironment</code> argument; this is a
state variable created by the Splice Machine optimizer, which methods
can use to pass information to each other or to learn other details
about the operating environment..</p>

    <p class="body">Here is the implementation of costing methods for our
<code>PropertiesFileVTI</code> class:</p>

    <div class="preWrapperWide">

      <pre class="Example"><code>@Override
public double getEstimatedCostPerInstantiation(VTIEnvironment arg0) throws SQLException {
    return 0;
}

@Override
public double getEstimatedRowCount(VTIEnvironment arg0) throws SQLException {
    return 0;
}
@Override
public boolean supportsMultipleInstantiations(VTIEnvironment arg0) throws SQLException {
    return false;
}
</code></pre>

    </div>
    <h3 id="Implemen4">Implement Other DatasetProvider Methods</h3>

    <p class="body">You also need to implement two additional <code>DatasetProvider</code> methods:</p>

    <ul>
      <li>
        <p><code>getOperationContext</code> simply returns the current operation context
(this.<code>operationContext</code>).</p>

        <div class="preWrapperWide">
          <pre class="Example"><code>OperationContext getOperationContext();
</code></pre>

        </div>
      </li>
      <li>
        <p><code>getMetaData</code> returns metadata that is used to dynamically bind your
table function; this metadata includes a column descriptor for each
column in your virtual table, including the name of the column, its
type, and its size. In our <code>PropertiesFileVTI</code>, we assign the
descriptors to a static variable, and our implementation of this
method simply returns that value.</p>

        <div class="preWrapperWide">
          <pre class="Example"><code>ResultSetMetaData getMetaData() throws SQLException;
</code></pre>

        </div>
      </li>
    </ul>

    <p class="body">Here is the implementation of these methods for our
<code>PropertiesFileVTI</code> class:</p>

    <div class="preWrapperWide">

      <pre class="Example"><code>@Override
public OperationContext getOperationContext() {
    return this.operationContext;
}@Override
public ResultSetMetaData getMetaData() throws SQLException {
    return metadata;
}

private static final ResultColumnDescriptor[] columnInfo = {
        EmbedResultSetMetaData.getResultColumnDescriptor("KEY1", Types.VARCHAR, false, 200),
        EmbedResultSetMetaData.getResultColumnDescriptor("VALUE", Types.VARCHAR, false, 200),
};

private static final ResultSetMetaData metadata = new EmbedResultSetMetaData(columnInfo);
}
</code></pre>

    </div>
    <h3 id="Use">Use Your Custom Virtual Table Interface</h3>

    <p class="body">You can create a table function in your Splice Machine database to
simplify use of your custom VTI. Here’s a table declaration for our
custom interface:</p>

    <div class="preWrapperWide">
      <pre class="Example"><code>CREATE FUNCTION propertiesFile(propertyFilename VARCHAR(200))
    RETURNS TABLE
       (
         KEY_NAME varchar(100)
         VALUE varchar(200)
       )
    LANGUAGE JAVA
    PARAMETER STYLE SPLICE_JDBC_RESULT_SET
    READS SQL DATA
    EXTERNAL NAME 'com.splicemachine.tutorials.vti.PropertiesFIleVTI.getPropertiesFileVTI';
</code></pre>

    </div>
    <p class="body">You can now use your interface with table function syntax; for example:</p>

    <div class="preWrapperWide">
      <pre class="Example"><code>select * from table (propertiesFile('sample.properties')) b;
</code></pre>

    </div>
    <p class="body">You can also use your interface by using VTI syntax in an SQL query; for
example:</p>

    <div class="preWrapperWide">
      <pre class="Example"><code>select * from new com.splicemachine.tutorials.vti.PropertiesFileVTI('sample.properties')
    as b (KEY_NAME VARCHAR(20), VALUE VARCHAR(100));
</code></pre>

    </div>
    <h2 id="VirtualFile">The Splice Machine Built-in VTI Classes</h2>

    <p>This section describes the built-in VTI classes:</p>

    <ul>
      <li><a href="#The">The <code>SpliceFileVTI</code> class </a></li>
      <li><a href="#Using">The <code>SpliceJDBCVTI</code> class </a></li>
    </ul>

    <h3 id="The">The SpliceFileVTI Class</h3>

    <p>You can use the <code>SpliceFileVTI</code> class to apply SQL queries to a file,
such as a csv file, as shown in the examples below.</p>

    <h4 id="constructors">Constructors</h4>

    <p>You can use the following constructor methods with the
<code>SpliceFileVTI</code> class. Each creates a virtual table from a file:</p>

    <div class="fcnWrapperWide">
      <pre class="FcnSyntax"><code>public SpliceFileVTI(String fileName)
</code></pre>

    </div>
    <div class="fcnWrapperWide">

      <pre class="FcnSyntax"><code>public SpliceFileVTI(String fileName,
                     String characterDelimiter,
                     String columnDelimiter)
</code></pre>

    </div>
    <div class="fcnWrapperWide">

      <pre class="FcnSyntax"><code>public SpliceFileVTI(String fileName,
                     String characterDelimiter,
                     String columnDelimiter,
                     boolean oneLineRecords)
</code></pre>

    </div>
    <div class="paramList">
      <p class="paramName">fileName</p>

      <p class="paramDefnFirst">The name of the file that you are reading.</p>

      <p class="paramName">characterDelimiter</p>

      <p class="paramDefnFirst">Specifies which character is used to delimit strings in the imported
data. You can specify <code>null</code> or the empty string (<code>''</code>) to use the
default string delimiter, which is the double-quote (<code>"</code>). If your input
contains control characters such as newline characters, make sure that
those characters are embedded within delimited strings.</p>

      <p class="paramName">columnDelimiter</p>

      <p class="paramDefnFirst">The character used to separate columns, Specify <code>null</code> if using the
comma (<code>,</code>) character as your delimiter. Note that the backslash
(<code>\</code>) character is not allowed as the column delimiter.</p>

      <p class="paramName">oneLineRecords</p>

      <p class="paramDefnFirst">A Boolean value that specifies whether each line in the import file
contains one complete record; if you specify false, records can span
multiple lines in the input file.</p>

    </div>
    <h3 id="Using">The SpliceJDBCVTI Class</h3>

    <p>You can use the <code>SpliceJDBCVTI</code> class to access external databases that
provide JDBC connections.</p>

    <h4 id="constructors-1">Constructors</h4>

    <p>You can use the following constructor methods with the
<code>SpliceJDBCVTI</code> class.</p>

    <div class="fcnWrapperWide">

      <pre class="FcnSyntax"><code>public SpliceJDBCVTI(String connectionUrl,
                     String schemaName,
                     String tableName)
</code></pre>

    </div>
    <div class="paramList">
      <p class="paramName">connectionURL</p>

      <p class="paramDefnFirst">The URL of the database connection you are using.</p>

      <p class="paramName">schemaName</p>

      <p class="paramDefnFirst">The name of the database schema.</p>

      <p class="paramName">tableName</p>

      <p class="paramDefnFirst">The name of the table in the database schema.</p>

    </div>
    <div class="fcnWrapperWide">

      <pre class="FcnSyntax"><code>public SpliceJDBCVTI(String connectionUrl,
                     String sql)
</code></pre>

    </div>
    <div class="paramList">
      <p class="paramName">connectionURL</p>

      <p class="paramDefnFirst">The URL of the database connection you are using.</p>

      <p class="paramName">sql</p>

      <p class="paramDefnFirst">The SQL string to execute in that database.</p>

    </div>
    <h2 id="see-also">See Also</h2>

    <p class="body">We recommend visiting the <a href="http://db.apache.org/derby/docs/10.9/publishedapi/jdbc3/org/apache/derby/vti/package-summary.html" target="_blank">Derby VTI documentation</a>, which provides full reference documentation for the
VTI class hierarchy.</p>

  </div>
</section>



    <div class="tags">
        
    </div>



</div>

<hr class="shaded"/>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2018 Splice Machine, Inc. All rights reserved. <br />
 Site last generated: Jan 22, 2018 <br />
<p><img src="images/company_logo.png" alt="Company logo"/></p>
                </div>
            </div>
</footer>


        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
    </div>

        <!-- Swiftype script; values depend on which built type and which build version -->

<script type="text/javascript">
(function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
(w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
})(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

_st('install','YGtH3zGt4NJzs35yCo5A','2.0.0', {
  install: {
    hooks: {
      query_filter: function(query) {
        query.setFilterDataByDocumentTypeSlugAndFilterField('page', 'buildversion', { values: ['2.7.0'], type: "and" });

        return query;
      }
    }
  }
});
</script>


</body>
    <!-- Only include analytics scripts if generating the customer docs -->


</html>
