<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="How to back up your database, and how to restore your database from a backup.">
<meta name="keywords" content=" back up, restore, backup, backup restore, backing up, restoring, incremental backup, full backup">
<title>Backing Up and Restoring Your Database | Splice Machine Documentation</title>
<meta class="swiftype" name="title" data-type="string" content="Backing Up and Restoring Your Database">
<meta class="swiftype" name="info" data-type="string" content="How to back up your database, and how to restore your database from a backup.">

<link rel="stylesheet" href="css/syntax.css">


<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="css/modern-business.css">
<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<!--<link rel="stylesheet" href="css/lavish-bootstrap.css"> -->
<!--<link rel="stylesheet" href="css/customstyles.css"> -->
<link rel="stylesheet" href="css/splicemain.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4000/feed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container-fluid topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> Splice Machine Internal Docs</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li>
                <!-- entries without drop-downs appear here -->
                
                    
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                   
                      <li class="dropdown">
                          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Splice Machine<b class="caret"></b></a>
                          <ul class="dropdown-menu">
                             
                                
                                   <li><a href="index.html">Welcome</a></li>
                               
                             
                                
                                   <li><a href="tutorials_intro.html">Tutorials</a></li>
                               
                             
                                
                                   <li><a href="sqlref_intro.html">SQL Reference Manual</a></li>
                               
                             
                                
                                   <li><a href="developers_intro.html">Developer's Manual</a></li>
                               
                             
                                
                                   <li><a href="cmdlineref_intro.html">Command Line Reference</a></li>
                               
                             
                                
                                   <li><a href="dbconsole_intro.html">Database Console</a></li>
                               
                             
                                
                                   <li><a href="notes_intro.html">General Information</a></li>
                               
                             
                          </ul>
                      </li>
                   
                      <li class="dropdown">
                          <a href="#" class="dropdown-toggle" data-toggle="dropdown">DB-Service Only<b class="caret"></b></a>
                          <ul class="dropdown-menu">
                             
                                
                                   <li><a href="dbaas_intro.html">Welcome!</a></li>
                               
                             
                                
                                   <li><a href="dbaas_cm_intro.html">Cloud Manager Guide</a></li>
                               
                             
                                
                                   <li><a href="dbaas_zep_intro.html">Using Zeppelin</a></li>
                               
                             
                                
                                   <li><a href="dbaas_info_intro.html">Release Information</a></li>
                               
                             
                          </ul>
                      </li>
                   
                      <li class="dropdown">
                          <a href="#" class="dropdown-toggle" data-toggle="dropdown">On-Premise-DB Only<b class="caret"></b></a>
                          <ul class="dropdown-menu">
                             
                                
                                   <li><a href="onprem_intro.html">Welcome!</a></li>
                               
                             
                                
                                   <li><a href="onprem_install_intro.html">Installation</a></li>
                               
                             
                                
                                   <li><a href="onprem_admin_intro.html">Administrator's Guide</a></li>
                               
                             
                                
                                   <li><a href="onprem_info_intro.html">Release Information</a></li>
                               
                             
                          </ul>
                      </li>
                   
                
                <li>
<!-- Start Swiftype search -->
                    <div id="swiftype-search-container">
                        <form>
                          <input type="text" class="st-default-search-input swiftype-input">
                          <button type="submit" class="swiftype-submit">Search</button>
                        </form>
                    </div>
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container-fluid">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                

<ul id="mysidebar" class="nav">
    <li class="sidebarTitle">Splice Machine 2.6.1</li>
    
    
    
    <li>
        <a href="#">On-Premise DB</a>
        <ul>
            
            
            
            <li><a href="onprem_intro.html">Welcome!</a></li>
            
            
            
            
            
            
            <li><a href="onprem_about.html">About Our On-Premise DB</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">On-Premise Installation</a>
        <ul>
            
            
            
            <li><a href="onprem_install_intro.html">Installing Splice Machine</a></li>
            
            
            
            
            
            
            <li><a href="onprem_install_awssandbox.html">Splice Machine AWS Sandbox</a></li>
            
            
            
            
            
            
            <li><a href="onprem_install_cloudera.html">Install for Cloudera</a></li>
            
            
            
            
            
            
            <li><a href="onprem_install_hortonworks.html">Install for Hortonworks HDP</a></li>
            
            
            
            
            
            
            <li><a href="onprem_install_mapr.html">Install for MapR</a></li>
            
            
            
            
            
            
            <li><a href="onprem_install_standalone.html">Install Standalone Version</a></li>
            
            
            
            
            
            
            <li><a href="onprem_install_demodata.html">Install Standalone Demo Data</a></li>
            
            
            
            
            
            
            <li><a href="onprem_install_configureauth.html">Configure Authentication</a></li>
            
            
            
            
            
            
            <li><a href="onprem_install_configureTLS.html">Configure SSL/TLS</a></li>
            
            
            
            
            
            
            <li><a href="onprem_install_upgradev2.0.html">Upgrading from V2.0 to V2.5</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">On Premise Administration</a>
        <ul>
            
            
            
            <li><a href="onprem_admin_intro.html">Introduction</a></li>
            
            
            
            
            
            
            <li><a href="onprem_admin_startingdb.html">Starting Your Database</a></li>
            
            
            
            
            
            
            <li class="active"><a href="onprem_admin_backingup.html">Backing Up</a></li>
            
            
            
            
            
            
            <li><a href="onprem_admin_cleaningdb.html">Cleaning Your Database</a></li>
            
            
            
            
            
            
            <li><a href="onprem_admin_shuttingdowndb.html">Shutting Down Your Database</a></li>
            
            
            
            
            
            
            <li><a href="onprem_admin_derbyprops.html">Derby Property Access</a></li>
            
            
            
            
            
            
            <li><a href="onprem_admin_enablingenterprise.html">Enabling Enterprise Edition</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">Release Information</a>
        <ul>
            
            
            
            <li><a href="onprem_info_intro.html">Introduction</a></li>
            
            
            
            
            
            
            <li><a href="onprem_info_release.html">Release Notes v2.6.1</a></li>
            
            
            
            
            
            
            <li><a href="onprem_info_release2.5.html">Release Notes v2.5</a></li>
            
            
            
            
            
            
            <li><a href="onprem_info_newfeatures.html">New Feature Notes</a></li>
            
            
            
            
            
            
            <li><a href="onprem_info_workarounds.html">Limits and Workarounds</a></li>
            
            
            
            
            
            
            <li><a href="onprem_info_requirements.html">Requirements</a></li>
            
            
            
            
            
            
            <li><a href="notes_usingdocs.html">About our Documentation</a></li>
            
            
            
            
            
            
            <li><a href="onprem_info_editions.html">Enterprise Edition Support</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">Splice Machine Home</a>
        <ul>
            
            
            
            <li><a href="https://www.splicemachine.com" target="_blank">Splice Machine Home Page</a></li>
            
            
            
            
            
            
            <li><a href="https://www.splicemachine.com/product/" target="_blank">Splice Machine Product Page</a></li>
            
            
            
            
            
            
            <li><a href="https://www.splicemachine.com/solutions/" target="_blank">Splice Machine Solutions</a></li>
            
            
            
            
            
            
            <li><a href="https://www.splicemachine.com/services/support/" target="_blank">Splice Machine Support</a></li>
            
            
            
            
            
            
            <li><a href="https://www.splicemachine.com/resources/" target="_blank">Splice Machine Resources</a></li>
            
            
            
            
            
            
            <li><a href="https://www.splicemachine.com/community/" target="_blank">Splice Machine Community</a></li>
            
            
            
            
        </ul>
     </li>
       
        
        
        <!-- if you aren't using the accordion, uncomment this block:
           <p class="external">
               <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
           </p>
           -->
</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            

<div class="post-content">

<!--- Don't automatically put page summary at top - GRH 05/2017:
   
    <div class="summary">How to back up your database, and how to restore your database from a backup.</div>
   
-->

    


    

  <section>
<div class="TopicContent" data-swiftype-index="true">
    <h1 id="backing-up-and-restoring-your-database">Backing Up and Restoring Your Database</h1>

    <div class="openSourceNote">
      <p><span class="noteEnterpriseNote">ENTERPRISE ONLY: This feature is
available only for the Splice Machine Enterprise version of our
On-Premise Database product.</span></p>

      <p>You cannot use this feature with the Community editions of Splice Machine. For a list of the additional features available in the Enterprise edition, see our <a href="notes_editions.html">Splice Machine
Editions</a> page.</p>

      <p>To obtain a license for the Splice Machine <em>Enterprise Edition</em>, <span class="noteEnterpriseNote">please <a href="http://www.splicemachine.com/company/contact-us/">Contact Splice Machine Sales</a>
today.</span></p>

    </div>

    <p>Splice Machine provides built-in system procedures that make it easy to
back up and restore your entire database. You can:</p>

    <ul>
      <li>create full and incremental backups to run immediately</li>
      <li>schedule daily full or incremental backups</li>
      <li>restore your database from a backup</li>
      <li>manage your backups</li>
      <li>access logs of your backups</li>
    </ul>

    <p>The rest of this topic will help you with working with your backups, in
these sections:</p>

    <ul>
      <li><a href="#About">About Splice Machine Backups</a></li>
      <li><a href="#Using">Using the Backup Operations</a></li>
      <li><a href="#Backing">Backing Up to Cloud Storage</a></li>
    </ul>

    <h2 id="About">About Splice Machine Backups</h2>

    <p>Splice Machine supports: both full and incremental backups: </p>

    <ul>
      <li>A <em>full backup</em> backs up all of the files/blocks that constitute your
database.</li>
      <li>An <em>incremental backup</em> only stores database files/blocks that have
changed since a previous backup.</li>
    </ul>

    <p>Because backups can consume a lot of disk space, most customers define a
backup strategy that blends their needs for security, recover-ability,
and space restrictions. Since incremental backups require a lot less
space than do full backups, and allow for faster recovery of data, many
customers schedule daily, incremental backups.</p>

    <p class="noteNote">Splice Machine automatically detects when it is the first run of an
incremental backup and performs a one-time full backup; subsequent runs
will only back up changed files/blocks.</p>

    <h3 id="backup-ids-backupjobs-and-backup-tables">Backup IDs, Backup Jobs, and Backup Tables</h3>

    <p>Splice Machine uses <em>backup IDs</em> to identify a specific full or
incremental <em>backup</em> that is stored on a file system, and <em>backup job
IDs</em> to identify each scheduled <em>backup job</em>. Information about backups
and backup jobs is stored in these system tables:</p>

    <table summary="Table of Splice Machine system backup tables.">
                <col />
                <col />
                <thead>
                    <tr>
                        <th>System Table</th>
                        <th>Contains Information About</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>SYS.SYSBACKUP</code>
                        </td>
                        <td>Each database backup; you can query this table to find the ID of and details about a backup that was run at a specific time.</td>
                    </tr>
                    <tr>
                        <td><code>SYS.SYSBACKUPITEMS</code>
                        </td>
                        <td>Each item (table) in a backup.</td>
                    </tr>
                    <tr>
                        <td><code>SYS.SYSBACKUPJOBS</code>
                        </td>
                        <td>Each backup job that has been run for the database.</td>
                    </tr>
                </tbody>
            </table>
    <h3 id="temporary-tables-and-backups">Temporary Tables and Backups</h3>

    <p>There’s a subtle issue with performing a backup when you’re using a
temporary table in your session: although the temporary table is
(correctly) not backed up, the temporary table’s entry in the system
tables will be backed up. When the backup is restored, the table entries
will be restored, but the temporary table will be missing.</p>

    <p>There’s a simple workaround:</p>

    <ol>
      <li>Exit your current session, which will automatically delete the
temporary table and its system table entries.</li>
      <li>Start a new session (reconnect to your database).</li>
      <li>Start your backup job.</li>
    </ol>

    <h2 id="Using">Using the Backup Operations</h2>

    <p>This section summarizes and provides examples of using the Splice
Machine backup operations:</p>

    <ul>
      <li><a href="#Scheduling">Scheduling a Daily Backup Job</a></li>
      <li><a href="#Running">Running an Immediate Backup</a></li>
      <li><a href="#Restorin">Restoring Your Database From a Previous Backup</a></li>
      <li><a href="#Reviewing">Reviewing Backup Information</a></li>
      <li><a href="#Cancelin">Canceling a Scheduled Backup Job</a></li>
      <li><a href="#CancelB" class="WithinBook">Canceling a Backup That’s In Progress</a></li>
      <li><a href="#Deleting">Deleting a Backup</a></li>
      <li><a href="#DeleteOld">Deleting Outdated Backups</a></li>
    </ul>

    <p>You must make sure that the directory to which you are backing up or
from which data is being restored is accessible to the HBase user who is
initiating the restore. Make sure the directory permissions are set
correctly on the backup directory.</p>

    <p class="noteNote">Note that you can store your backups in a cloud-based storage service
such as AWS; for more information, see the <a href="#Backing">Backing Up to Cloud
Storage</a> section below.</p>

    <h3 id="Scheduling">Scheduling a Daily Backup Job</h3>

    <p>Use the
<a href="sqlref_sysprocs_scheduledailybackup.html"><code>SYSCS_UTIL.SYSCS_SCHEDULE_DAILY_BACKUP</code></a> system
procedure to schedule a job that performs a daily incremental or full
backup of your database:</p>

    <div class="fcnWrapperWide">
      <pre class="FcnSyntax"><code>SYSCS_UTIL.SYSCS_SCHEDULE_DAILY_BACKUP( backupDir, backupType, startHour );
</code></pre>

    </div>
    <div class="paramList">
      <p class="paramName">backupDir</p>

      <p class="paramDefnFirst">A <code>VARCHAR</code> value that specifies the path to the directory in which you
want the backup stored.</p>

      <p class="paramDefn">Note that this directory can be cloud-based, as described in the
<a href="#Backing">Backing Up to Cloud Services</a> section below.</p>

      <p class="paramName">backupType</p>

      <p class="paramDefnFirst">A <code>VARCHAR(30)</code> value that specifies the type of backup that you want
performed; one of the following values: <code>full</code> or <code>incremental</code>. The
first run of an incremental backup is always a full backup.</p>

      <p class="paramName">startHour</p>

      <p class="paramDefnFirst">Specifies the hour (<code>0-23</code>) in GMT at which you want the backup to run
each day. A value less than <code>0</code> or greater than <code>23</code> produces an error
and the backup is not scheduled.</p>

      <h4 id="example-1set-up-a-full-backup-to-run-every-day-at-3am">Example 1: Set up a full backup to run every day at 3am:</h4>

      <p>To run a full backup every night at 3am:</p>

      <div class="preWrapperWide">
        <pre class="AppCommand"><code>call SYSCS_UTIL.SYSCS_SCHEDULE_DAILY_BACKUP('/home/backup', 'full', 3);
</code></pre>

      </div>
      <div>
        <h4 id="example-2set-up-an-incremental-backup-to-run-every-day-at-noon">Example 2: Set up an incremental backup to run every day at noon:</h4>

        <p>To run an incremental backup every day at noon.</p>

        <div class="preWrapperWide">
          <pre class="AppCommand"><code>call SYSCS_UTIL.SYSCS_BACKUP_DATABASE('/home/backup', 'incremental', 12);
</code></pre>

        </div>
      </div>
    </div>
    <h3 id="Running">Running an Immediate Backup</h3>

    <p>Use the
<a href="sqlref_sysprocs_backupdb.html"><code>SYSCS_UTIL.SYSCS_BACKUP_DATABASE</code></a>
system procedure to immediately run a full or incremental backup.</p>

    <div class="fcnWrapperWide">
      <pre class="FcnSyntax"><code>SYSCS_UTIL.SYSCS_BACKUP_DATABASE( backupDir, backupType );
</code></pre>

    </div>
    <div class="paramList">
      <p class="paramName">backupDir</p>

      <p class="paramDefnFirst">A <code>VARCHAR</code> value that specifies the path to the directory in which you
want the backup stored.</p>

      <p class="paramDefn">Note that this directory can be cloud-based, as described in the
<a href="#Backing">Backing Up to Cloud Services</a> section below.</p>

      <p class="paramName">backupType</p>

      <p class="paramDefnFirst">A <code>VARCHAR(30)</code> value that specifies the type of backup that you want
performed; use.one of the following values: <code>full</code> or <code>incremental</code>.</p>

      <h4 id="example-1execute-a-full-backup-now">Example 1: Execute a full backup now</h4>

      <p>To execute a backup right now:</p>

      <div class="preWrapperWide">
        <pre class="AppCommand"><code>call SYSCS_UTIL.SYSCS_BACKUP_DATABASE('/home/backup', 'full');
</code></pre>

      </div>
      <div>
        <h4 id="example-2execute-an-incremental-backup-now">Example 2: Execute an incremental backup now:</h4>

        <p>This call will run an incremental backup right now. Splice Machine
checks the  <a href="sqlref_systables_sysbackup.html"><code>SYSBACKUP System Table</code></a>
to determine if there already is a backup for the system; if not, Splice
Machine will perform a full backup, and subsequent backups will be
incremental. The backup data is stored in the specified directory.</p>

        <div class="preWrapperWide">
          <pre class="AppCommand"><code>call SYSCS_UTIL.SYSCS_BACKUP_DATABASE('/home/backup', 'incremental');
</code></pre>

        </div>
      </div>
    </div>
    <h3 id="Restorin">Restoring Your Database From a Previous Backup</h3>

    <p>You can restore your database from a previous backup, use the
<a href="sqlref_sysprocs_restoredb.html"><code>SYSCS_UTIL.SYSCS_RESTORE_DATABASE</code></a> system
procedure.</p>

    <p>To restore your database from a previous backup, use the
<a href="sqlref_sysprocs_restoredb.html"><code>SYSCS_UTIL.SYSCS_RESTORE_DATABASE</code></a> system
procedure:</p>

    <div class="fcnWrapperWide">
      <pre class="FcnSyntax"><code>SYSCS_UTIL.SYSCS_RESTORE_DATABASE(backupDir, backupId);
</code></pre>

    </div>
    <div class="paramList">
      <p class="paramName">backupDir</p>

      <p class="paramDefnFirst">A <code>VARCHAR</code> value that specifies the path to the directory in which the
backup isstored.</p>

      <p class="paramDefn">You can find the <em>backupId</em> you want to use by querying the  <a href="sqlref_systables_sysbackup.html"><code>SYSBACKUP
System Table</code></a>. See the <a href="#Reviewing">Reviewing
Backup Information</a> section below for more information.</p>

      <p class="paramName">backupId</p>

      <p class="paramDefnFirst">A <code>BIGINT</code> value that specifies which backup you want to use to restore
your database.</p>

    </div>
    <div class="notePlain">
      <p>There are several important things to know about restoring your database
from a previous backup:</p>

      <ul>
        <li>Restoring a database <strong>wipes out your database</strong> and replaces it with
what had been previously backed up.</li>
        <li>You <strong>cannot use your cluster</strong> while restoring your database.</li>
        <li>You <strong>must reboot your database</strong> after the restore is complete by
first <a href="onprem_admin_startingdb.html">Starting Your Database</a>.</li>
      </ul>

    </div>
    <blockquote>
      <h4 id="examplerestore-the-database-from-a-local-full-backup">Example: Restore the database from a local, full backup</h4>

      <p>This example restores your database from the backup stored in the
<code>/home/backup</code> directory that has <code>backupId=1273</code>:</p>

      <div class="preWrapperWide">
        <pre class="AppCommand"><code>call SYSCS_UTIL.SYSCS_RESTORE_DATABASE('/home/backup', 1273);
</code></pre>

      </div>
    </blockquote>

    <h3 id="Reviewing">Reviewing Backups</h3>

    <p>Splice Machine stores information about your backups and scheduled
backup jobs in system tables that you can query, and stores a backup log
file in the directory to which a backup is written when it runs.</p>

    <h4 id="backup-job-information">Backup Job Information</h4>

    <p>Information about your scheduled backup jobs is stored in the
<a href="sqlref_systables_sysbackupjobs.html"><code>SYSBACKUPJOBS System Table</code></a>:</p>

    <div class="preWrapperWide">
      <pre class="Example"><code>splice&gt; select * from SYS.SYSBACKUPJOBS;
JOB_ID         |FILESYSTEM        |TYPE           |HOUR_OF_DAY|BEGIN_TIMESTAMP
--------------------------------------------------------------------------------------
22275          |/data/backup/0101 |FULL           |22         |2015-04-03 18:43:42.631
</code></pre>

    </div>
    <p>You can query this table to find a job ID, if you need to cancel a
scheduled backup.</p>

    <h4 id="backup-information">Backup Information</h4>

    <p>Information about each backup of your database is stored in the
<a href="sqlref_systables_sysbackup.html"><code>SYSBACKUP System Table</code></a>, including
the ID assigned to the backup and its location. You can query this table
to find the ID of a specific backup, which you need if you want to
restore your database from it, or to delete it:</p>

    <div class="preWrapperWide">
      <pre class="Example"><code>splice&gt; select * from SYS.SYSBACKUP;
BACKUP_ID |BEGIN_TIMESTAMP         |END_TIMESTAMP           |STATUS |FILESYSTEM        |SCOPE |INCR&amp;|INCREMENTAL_PARENT_&amp;|BACKUP_ITEM
------------------------------------------------------------------------------------------------------------------------------------------
22275     |2015-04-03 18:40:56.877 |2015-04-03 18:43:42.631 |S      |/data/backup/0101 |D     |false|-1       |15
21428     |2015-04-03 18:30:55.964 |2015-04-03 18:33:49.494 |S      |/data/backup/0101 |D     |false|-1       |15
20793     |2015-04-03 18:23:53.574 |2015-04-03 18:27:07.07  |S      |/data/backup/0101 |D     |false|-1       |87
</code></pre>

    </div>
    <h4 id="backup-log-files">Backup Log Files</h4>

    <p>When you run a backup, a log file is created or updated in the directory
in which the backup is stored. This log file is named
<code>backupStatus.log</code>, and is stored in plain text, human-readable format.
Here’s a sample snippet from a log file:</p>

    <div class="preWrapperWide">

      <pre class="Example"><code>Expected time for backup ~12 hours, expected finish at 15:30 on April 8, 2015
5 objects of 833 objects backed up..
6 objects of 833 objects backed up

Finished with Success. Total time taken for backup was 11 hours 32 minutes.
</code></pre>

    </div>
    <h3 id="Cancelin">Canceling a Scheduled Backup</h3>

    <p>You can cancel a daily backup with the
<a href="sqlref_sysprocs_canceldailybackup.html"><code>SYSCS_UTIL.SYSCS_CANCEL_DAILY_BACKUP</code></a> system
procedure:</p>

    <div class="fcnWrapperWide">
      <pre class="FcnSyntax"><code>SYSCS_UTIL.SYSCS_CANCEL_DAILY_BACKUP( jobId );
</code></pre>

    </div>
    <div class="paramList">
      <p class="paramName">jobId</p>

      <p class="paramDefnFirst">A <code>BIGINT</code> value that specifies which scheduled backup job you want to
cancel.</p>

      <p class="paramDefn">You can find the <em>jobId</em> you want to cancel by querying the
<a href="sqlref_systables_sysbackupjobs.html"><code>SYSBACKUPJOBS System Table</code></a>.</p>

      <p class="noteNote">Once you cancel a daily backup, it will no longer be scheduled to run.</p>

      <h4 id="examplecancel-a-daily-backup">Example: Cancel a daily backup</h4>

      <p>This example cancels the backup that has <code>jobId=1273</code>:</p>

      <div class="preWrapperWide">
        <pre class="AppCommand"><code>call SYSCS_UTIL.SYSCS_CANCEL_DAILY_BACKUP(1273);
</code></pre>

      </div>
    </div>
    <h3 id="CancelB">Canceling a Backup That’s In Progress</h3>

    <p>You can call the
<a href="sqlref_sysprocs_cancelbackup.html"><code>SYSCS_UTIL.SYSCS_CANCEL_BACKUP</code></a> system
procedure to cancel a backup that is currently running:</p>

    <div class="fcnWrapperWide">
      <pre class="FcnSyntax"><code>SYSCS_UTIL.SYSCS_CANCEL_BACKUP(  );
</code></pre>

    </div>
    <div class="paramList">
      <h4 id="examplecancel-a-running-backup">Example: Cancel a running backup</h4>

      <p>This example cancels the Splice Machine backup job that is currently
running.</p>

      <div class="preWrapperWide">
        <pre class="AppCommand"><code>call SYSCS_UTIL.SYSCS_CANCEL_BACKUP();
</code></pre>

      </div>
    </div>
    <h3 id="Deleting">Deleting a Backup</h3>

    <p>Use the
<a href="sqlref_sysprocs_deletebackup.html"><code>SYSCS_UTIL.SYSCS_DELETE_BACKUP</code></a> system
procedure to delete a single backup:</p>

    <div class="fcnWrapperWide">
      <pre class="FcnSyntax"><code>SYSCS_UTIL.SYSCS_DELETE_BACKUP( backupId );
</code></pre>

    </div>
    <div class="paramList">
      <p class="paramName">backupId</p>

      <p class="paramDefnFirst">A <code>BIGINT</code> value that specifies which backup you want to delete.</p>

      <p class="paramDefn">You can find the <em>backupId</em> you want to delete by querying the
<a href="sqlref_systables_sysbackup.html"><code>SYSBACKUP System Table</code></a>,</p>

      <h4 id="exampledelete-a-backup">Example: Delete a backup</h4>

      <p>This example deletes the backup that has <code>backupId=1273</code>:</p>

      <div class="preWrapperWide">
        <pre class="AppCommand"><code>call SYSCS_UTIL.SYSCS_DELETE_BACKUP(1273);
</code></pre>

      </div>
    </div>
    <h3 id="DeleteOld">Deleting Outdated Backups</h3>

    <p>Use the
<a href="sqlref_sysprocs_deleteoldbackups.html"><code>SYSCS_UTIL.SYSCS_DELETE_OLD_BACKUPS</code></a> system
procedure to delete all backups that are older than a certain number of
days.</p>

    <div class="fcnWrapperWide">
      <pre class="FcnSyntax"><code>SYSCS_UTIL.SYSCS_DELETE_OLD_BACKUPS( backupWindow );
</code></pre>

    </div>
    <div class="paramList">
      <p class="paramName">backupWindow</p>

      <p class="paramDefnFirst">An <code>INT</code> value that specifies the number of days of backups that you
want retained. Any backups created more than <code>backupWindow</code> days ago are
deleted.</p>

      <h4 id="exampledelete-all-backups-more-than-a-week-old">Example: Delete all backups more than a week old</h4>

      <p>This example deletes all backups that are more than a week old:</p>

      <div class="preWrapperWide">
        <pre class="AppCommand"><code>call SYSCS_UTIL.SYSCS_DELETE_OLD_BACKUPS(7);
</code></pre>

      </div>
    </div>
    <h2 id="Backing">Backing Up to Cloud Storage - AWS</h2>

    <p>You can specify cloud-based directories as destinations for your
backups. This section describes how to set up credentials to allow
Splice Machine to create and manage backups on AWS.</p>

    <p>You need to enable backups by storing your AWS Access Key ID and Secret
Access Key values in your cluster’s HDFS core-site.xml file: how you set
up your credentials depends on the Hadoop platform you are using; see
the section below for your platform:</p>

    <div class="notePlain">
      <p><strong>IMPORTANT:</strong> You must have access to the S3 bucket to which you are
backing up your database. The instructions below give general
guidelines; however, S3 access differs in every deployment. For more
information, see these sites:</p>

      <ul>
        <li><a href="http://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html" target="_blank">http://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html</a></li>
        <li><a href="http://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html" target="_blank">https://wiki.apache.org/hadoop/AmazonS3</a></li>
      </ul>

    </div>
    <ul>
      <li><a href="#Enabling">Enabling backups on CDH</a></li>
      <li><a href="#Enabling2">Enabling backups on HDP</a></li>
      <li><a href="#Enabling3">Enabling backups on MapR</a></li>
    </ul>

    <h3 id="Enabling">Enabling Splice Machine Backups on CDH</h3>

    <p>You can use Cloudera Manager to configure properties to enable
Splice Machine backups; follow these steps:</p>

    <div class="opsStepsList">
      <ol class="boldFont">
        <li>Navigate to the Cloudera Manager home screen.</li>
        <li>
          <p class="topLevel">Stop both HBase and HDFS: </p>

          <ul>
            <li><span class="PlainFont">Click the <span class="AppCommand">HBase Actions</span> drop-down
arrow associated with (to the right of) <code>HBase</code> in the cluster
summary section of the home screen, and then click <span class="AppCommand">Stop</span> to stop HBase.</span></li>
            <li><span class="PlainFont">Click the <span class="AppCommand">HDFS Actions</span> drop-down
arrow associated with (to the right of) and then click <span class="AppCommand">Stop</span> to stop HDFS.</span></li>
          </ul>
        </li>
        <li>Click <span class="AppCommand">HDFS</span> in the Cloudera Manager
home screen, then click the <span class="AppCommand">Configuration</span> tab, and in category, click
<span class="AppCommand">Advanced</span>. Then set these property
values in the <code>Cluster-wide Advanced Configuration Snippet (Safety
Valve) for core-site.xml</code> field:
          <div class="preWrapperWide">

            <pre class="AppCommand"><code>fs.s3.awsAccessKeyId       = &lt;Your AWS Access Key&gt;
fs.s3.awsSecretAccessKey   = &lt;Your AWS Access Secret Key&gt;
</code></pre>

          </div>
        </li>
        <li>
          <p class="topLevel">Restart both services:</p>

          <ul>
            <li><span class="PlainFont">Click the <span class="AppCommand">HDFS Actions</span> drop-down
arrow associated with (to the right of) HDFS in the cluster
summary section of the Cloudera Manager home screen, and then
click <span class="AppCommand">Start</span> to restart HDFS.</span></li>
            <li><span class="PlainFont">Navigate to the <em>HBase Status</em> tab in Cloudera Manager. Then,
using the <span class="AppCommand">Actions</span> drop-down in the
upper-right corner, click <span class="AppCommand">Start</span> to
create a start HBase.</span></li>
          </ul>
        </li>
      </ol>

    </div>
    <h3 id="Enabling2">Enabling Splice Machine Backups on HDP</h3>

    <p>You can use the Ambari dashboard to configure these properties. Follow
these steps:</p>

    <div class="opsStepsList">
      <ol class="boldFont">
        <li>Navigate to the HDFS <span class="AppCommand">Configs</span> screen.</li>
        <li>
          <p class="topLevel">Select the <span class="AppCommand">Services</span> tab at the top
of the Ambari dashboard screen, then stop both HBase and HDFS: </p>

          <ul>
            <li><span class="PlainFont">Click <span class="AppCommand">HBase</span> in the left pane of
the screen, then click <span class="AppCommand">Service
Actions-&gt;Stop</span> in the upper-right portion of the Ambari
screen.</span></li>
            <li><span class="PlainFont">Click <span class="AppCommand">HDFS</span> in the left pane of the
screen, the click <span class="AppCommand">Service
Actions-&gt;Stop</span>.</span></li>
          </ul>
        </li>
        <li>Select <span class="AppCommand">Custom core-site</span> and add
these properties:
          <div class="preWrapperWide">

            <pre class="AppCommand"><code>fs.s3.awsAccessKeyId       = &lt;Your AWS Access Key&gt;
fs.s3.awsSecretAccessKey   = &lt;Your AWS Secret Access Key&gt;
</code></pre>

          </div>
        </li>
        <li>
          <p class="topLevel">Restart both services:</p>

          <ul>
            <li><span class="PlainFont">Click <span class="AppCommand">HDFS</span> in the left pane of the
screen, the click <span class="AppCommand">Service
Actions-&gt;Restart All</span>.</span></li>
            <li><span class="PlainFont">Click <span class="AppCommand">HBase</span> in the left pane of
the screen, the click <span class="AppCommand">Service
Actions-&gt;Restart All</span>.</span></li>
          </ul>
        </li>
      </ol>

    </div>
    <h3 id="Enabling3">Enabling Splice Machine Backups on MapR</h3>

    <p>To enable Amazon S3 access on a MapR cluster, you must stop services,
change the configuration files on each node, and then restart services.
Follow these steps:</p>

    <div class="opsStepsList">
      <ol class="boldFont">
        <li>
          <p class="topLevel">Stop all MapR services by stopping the warden service on each host:</p>

          <div class="preWrapper">
            <pre class="ShellCommand"><code>sudo service mapr-warden stop
</code></pre>

          </div>
        </li>
        <li>
          <p class="topLevel">You need to edit two files on each MapR-FS fileserver and HBase
RegionServer in your cluster to allow hosts access to Amazon S3. You
need to provide the fs.s3 access key ID and secret in each of these
files:</p>

          <ul>
            <li><span class="PlainFont"><code>/opt/mapr/hadoop/hadoop-2.x.x/etc/hadoop/core-site.xml</code> for
<em>Hadoop/MapReduce/YARN 2.x</em> site configuration</span></li>
            <li><span class="PlainFont"><code>/opt/mapr/hadoop/hadoop-0.x.x/conf/core-site.xml</code> for
<em>Hadoop/MapReduce 0.x/1.x</em> site configuration</span></li>
          </ul>

          <p>If both <em>MapReduce v1</em> and <em>YARN/MapReduce 2</em> are installed on the
MapR compute hosts, the newer <em>hadoop-2.x.x</em> version of the file
will be canonical, and the older <em>hadoop-0.x.x</em> file symbolically
linked to it. You can check this using the following <code>ls</code> and <code>file</code>
commands:</p>

          <div class="preWrapperWide">
            <pre class="ShellCommand"><code>$ ls -al /opt/mapr/hadoop/hadoop-0*/conf/core-site.xml /opt/mapr/hadoop/hadoop-2*/etc/hadoop/core-site.xml
lrwxrwxrwx 1 mapr root  54 Apr 24 11:01 /opt/mapr/hadoop/hadoop-0.20.2/conf/core-site.xml -&gt; /opt/mapr/hadoop/hadoop-2.5.1/etc/hadoop/core-site.xml
-rw-r--r-- 1 mapr root 775 Apr 24 12:50 /opt/mapr/hadoop/hadoop-2.5.1/etc/hadoop/core-site.xml
</code></pre>

          </div>

          <div class="preWrapperWide">
            <pre class="ShellCommand"><code>$ file /opt/mapr/hadoop/hadoop-0*/conf/core-site.xml /opt/mapr/hadoop/hadoop-2*/etc/hadoop/core-site.xml
/opt/mapr/hadoop/hadoop-0.20.2/conf/core-site.xml:      symbolic link to `/opt/mapr/hadoop/hadoop-2.5.1/etc/hadoop/core-site.xml'
/opt/mapr/hadoop/hadoop-2.5.1/etc/hadoop/core-site.xml: XML  document text
</code></pre>

          </div>
        </li>
        <li>
          <p class="topLevel">Add your access key ID and secret key in each file by adding the
following properties between the <code>&lt;configuration&gt;</code> and
<code>&lt;/configuration&gt;</code> tags:</p>

          <div class="preWrapperWide">
            <pre class="AppCommand"><code>&lt;!-- AWS s3://bucket/... block-based access --&gt;
&lt;property&gt;
&lt;name&gt;fs.s3.awsAccessKeyId&lt;/name&gt;
&lt;value&gt;_AWS_ACCESS_KEY_ID_&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;fs.s3.awsSecretAccessKey&lt;/name&gt;
&lt;value&gt;_AWS_SECRET_ACCESS_KEY_&lt;/value&gt;
&lt;/property&gt;
&lt;!-- AWS s3n://bucket/... filesystem-like access --&gt;
&lt;property&gt;
&lt;name&gt;fs.s3n.awsAccessKeyId&lt;/name&gt;
&lt;value&gt;_AWS_ACCESS_KEY_ID_&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;fs.s3n.awsSecretAccessKey&lt;/name&gt;
&lt;value&gt;_AWS_SECRET_ACCESS_KEY_&lt;/value&gt;
&lt;/property&gt;
</code></pre>

          </div>
        </li>
        <li>
          <p class="topLevel">Use the <code>hadoop</code> command to view your configuration changes:</p>

          <div class="preWrapperWide">
            <pre class="ShellCommand"><code>$ hadoop conf | grep fs\\.s3 | grep -i access | sort -u
&lt;property&gt;&lt;name&gt;fs.s3.awsAccessKeyId&lt;/name&gt;&lt;value&gt;_AWS_ACCESS_KEY_ID_&lt;/value&gt;&lt;source&gt;core-site.xml&lt;/source&gt;&lt;/property&gt;
&lt;property&gt;&lt;name&gt;fs.s3.awsSecretAccessKey&lt;/name&gt;&lt;value&gt;_AWS_SECRET_ACCESS_KEY_&lt;/value&gt;&lt;source&gt;core-site.xml&lt;/source&gt;&lt;/property&gt;
&lt;property&gt;&lt;name&gt;fs.s3n.awsAccessKeyId&lt;/name&gt;&lt;value&gt;_AWS_ACCESS_KEY_ID_&lt;/value&gt;&lt;source&gt;core-site.xml&lt;/source&gt;&lt;/property&gt;
&lt;property&gt;&lt;name&gt;fs.s3n.awsSecretAccessKey&lt;/name&gt;&lt;value&gt;_AWS_SECRET_ACCESS_KEY_&lt;/value&gt;&lt;source&gt;core-site.xml&lt;/source&gt;&lt;/property&gt;
</code></pre>

          </div>
        </li>
        <li>
          <p class="topLevel">You can also verify that access is correctly configured with the
<code>hadoop</code> command to list the contents of an existing bucket. For
example:</p>

          <div class="preWrapperWide">
            <pre class="ShellCommand"><code>sudo -iu mapr hadoop fs -ls s3n://yourbucketname/
</code></pre>

          </div>
        </li>
        <li>
          <p class="topLevel">Finally, restart MapR services on each node via MapR’s warden::</p>

          <div class="preWrapperWide">
            <pre class="ShellCommand"><code>sudo service mapr-warden start
</code></pre>

          </div>
        </li>
      </ol>

    </div>
    <h2 id="see-also">See Also</h2>

    <ul>
      <li><a href="sqlref_sysprocs_backupdb.html"><code>SYSCS_UTIL.SYSCS_BACKUP_DATABASE</code></a></li>
      <li><a href="sqlref_sysprocs_cancelbackup.html"><code>SYSCS_UTIL.SYSCS_CANCEL_BACKUP</code></a></li>
      <li><a href="sqlref_sysprocs_canceldailybackup.html"><code>SYSCS_UTIL.SYSCS_CANCEL_DAILY_BACKUP</code></a></li>
      <li><a href="sqlref_sysprocs_deletebackup.html"><code>SYSCS_UTIL.SYSCS_DELETE_BACKUP</code></a></li>
      <li><a href="sqlref_sysprocs_deleteoldbackups.html"><code>SYSCS_UTIL.SYSCS_DELETE_OLD_BACKUPS</code></a></li>
      <li><a href="sqlref_sysprocs_restoredb.html"><code>SYSCS_UTIL.SYSCS_RESTORE_DATABASE</code></a></li>
      <li><a href="sqlref_sysprocs_scheduledailybackup.html"><code>SYSCS_UTIL.SYSCS_SCHEDULE_DAILY_BACKUP</code></a></li>
      <li><a href="sqlref_systables_sysbackup.html"><code>SYSBACKUP System Table</code></a></li>
      <li><a href="sqlref_systables_sysbackupitems.html"><code>SYSBACKUPITEMS System Table</code></a></li>
      <li><a href="sqlref_systables_sysbackupjobs.html"><code>SYSBACKUPJOBS System Table</code></a></li>
    </ul>

  </div>
</section>



    <div class="tags">
        
    </div>



</div>

<hr class="shaded"/>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2017 Splice Machine, Inc. All rights reserved. <br />
 Site last generated: Sep 28, 2017 <br />
<p><img src="images/company_logo.png" alt="Company logo"/></p>
                </div>
            </div>
</footer>


        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
    </div>

        <!-- Swiftype script for docstest -->

    <script type="text/javascript">
    (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
    })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
      _st('install','YGtH3zGt4NJzs35yCo5A','2.0.0');
    </script>




</body>
    <!-- Only include analytics scripts if generating the customer docs -->


</html>
